(window.webpackJsonp=window.webpackJsonp||[]).push([[250],{631:function(t,s,a){"use strict";a.r(s);var e=a(26),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能优化"}},[t._v("#")]),t._v(" 性能优化")]),t._v(" "),a("p",[t._v("本质上提高运行效率，降低运行消耗的行为都可以看作是性能优化。")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("展开")]),t._v(" "),a("ul",[a("li",[t._v("打包优化\n"),a("ul",[a("li",[t._v("webpack\n"),a("ul",[a("li",[t._v("loader")]),t._v(" "),a("li",[t._v("dll")]),t._v(" "),a("li",[t._v("happypack")]),t._v(" "),a("li",[t._v("压缩代码")]),t._v(" "),a("li",[t._v("tree shaking")]),t._v(" "),a("li",[t._v("scope hoisting")]),t._v(" "),a("li",[t._v("code splitting")])])]),t._v(" "),a("li",[t._v("图片 base64,cdn")])])]),t._v(" "),a("li",[t._v("网络优化\n"),a("ul",[a("li",[t._v("dns")]),t._v(" "),a("li",[t._v("cdn")]),t._v(" "),a("li",[t._v("缓存")]),t._v(" "),a("li",[t._v("preload/prefetch/懒加载")]),t._v(" "),a("li",[t._v("ssr")])])]),t._v(" "),a("li",[t._v("代码优化\n"),a("ul",[a("li",[t._v("loading/骨架屏")]),t._v(" "),a("li",[t._v("web worker")]),t._v(" "),a("li",[t._v("虚拟列表")]),t._v(" "),a("li",[t._v("懒加载 dom/style 批量更新")])])])])]),t._v(" "),a("h2",{attrs:{id:"概要-前端性能优化-六大角度综合性优化方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概要-前端性能优化-六大角度综合性优化方案"}},[t._v("#")]),t._v(" 概要（前端性能优化-六大角度综合性优化方案）")]),t._v(" "),a("p",[t._v("使用流行的性能优化技术，快速提高 Web 性能")]),t._v(" "),a("h3",{attrs:{id:"性能优化意义何在"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能优化意义何在"}},[t._v("#")]),t._v(" 性能优化意义何在？")]),t._v(" "),a("p",[t._v("WPOStarts 性能优化案例库-业界经验")]),t._v(" "),a("p",[t._v("高性能")]),t._v(" "),a("ul",[a("li",[t._v("用户参与度-用户留存")]),t._v(" "),a("li",[t._v("高转换率-SEO 排名")]),t._v(" "),a("li",[t._v("业务收益")])]),t._v(" "),a("p",[t._v("我们优化的工作是围绕 web 的基本工作原理来展开的，包括客户端服务端去进行连接，然后对这些资源去进行加载，加载到的资源如何进行解析和渲染，每个环节都可以去做优化")]),t._v(" "),a("h3",{attrs:{id:"行动的标准是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#行动的标准是什么"}},[t._v("#")]),t._v(" 行动的标准是什么？")]),t._v(" "),a("p",[t._v("loading\n动画\n事件处理")]),t._v(" "),a("h2",{attrs:{id:"性能优化指标与测量工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能优化指标与测量工具"}},[t._v("#")]),t._v(" 性能优化指标与测量工具")]),t._v(" "),a("ul",[a("li",[t._v("行业的标准")]),t._v(" "),a("li",[t._v("优化模型")]),t._v(" "),a("li",[t._v("测量工具")]),t._v(" "),a("li",[t._v("性能相关 APIS")])]),t._v(" "),a("h3",{attrs:{id:"为什么要进行-web-性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要进行-web-性能优化"}},[t._v("#")]),t._v(" 为什么要进行 Web 性能优化")]),t._v(" "),a("p",[t._v("互联网发展非常快，网站内容越来越多，功能越来越强大，页面越做越漂亮。内容多了，速度会受到影响，但是用户却希望速度越来越快，只能对网站进行持续的优化，才能保证在发展的过程中，我们始终网站的速度能跟得上用户体验的一个需求")]),t._v(" "),a("h3",{attrs:{id:"性能-web-网站和应用的支柱"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能-web-网站和应用的支柱"}},[t._v("#")]),t._v(" 性能-Web 网站和应用的支柱")]),t._v(" "),a("p",[t._v("流量 =》搜索 =》转换率 =》用户体验")]),t._v(" "),a("p",[t._v("阅读：Amazon 发现每 100ms 延迟导致 1%的销量损失")]),t._v(" "),a("h3",{attrs:{id:"寻找性能瓶颈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#寻找性能瓶颈"}},[t._v("#")]),t._v(" 寻找性能瓶颈")]),t._v(" "),a("ul",[a("li",[t._v("了解性能指标-多块才算快")]),t._v(" "),a("li",[t._v("利用测量工具和 APIS")]),t._v(" "),a("li",[t._v("优化问题，重新测量（迭代）")])]),t._v(" "),a("h3",{attrs:{id:"移动端挑战多"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移动端挑战多"}},[t._v("#")]),t._v(" 移动端挑战多")]),t._v(" "),a("ul",[a("li",[t._v("设备硬件、网速、屏幕尺寸、交互方式")]),t._v(" "),a("li",[t._v("用户更缺少耐心，>3 秒加载导致 53%的跳出率（bounce rate）")]),t._v(" "),a("li",[t._v("持续增长的移动用户和移动电商业务")])]),t._v(" "),a("h3",{attrs:{id:"性能指标和优化目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能指标和优化目标"}},[t._v("#")]),t._v(" 性能指标和优化目标")]),t._v(" "),a("p",[t._v("以淘宝为例")]),t._v(" "),a("p",[a("strong",[t._v("Network")])]),t._v(" "),a("p",[a("strong",[t._v("LightHouse")])]),t._v(" "),a("p",[t._v("First Contentful Paint 第一次出现内容的时间")]),t._v(" "),a("p",[t._v("Speed Index 速度指数（4s）")]),t._v(" "),a("p",[a("strong",[t._v("Performance")])]),t._v(" "),a("p",[a("strong",[t._v("性能优化-加载")])]),t._v(" "),a("ul",[a("li",[t._v("理解加载瀑布图")]),t._v(" "),a("li",[t._v("基于 HAR 存储与重建性能信息")]),t._v(" "),a("li",[t._v("速度指数（Speed Index）")]),t._v(" "),a("li",[t._v("重要测量指标\nSpeed Index\nTTFB 请求发送出去，到响应回来时间\n页面加载时间 页面加载完要多少时间\n首次渲染 第一次内容时间")])]),t._v(" "),a("p",[a("strong",[t._v("性能优化-响应")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("交互动作的反馈时间")]),t._v(" "),a("p",[t._v("交互响应要足够快")])]),t._v(" "),a("li",[a("p",[t._v("帧率 FPS\n在开发者工具中，ctrl-shift-p >frame =>show frames 监控页面帧数变化，画面要足够流畅")])]),t._v(" "),a("li",[a("p",[t._v("异步请求的完成时间")]),t._v(" "),a("p",[t._v("所有异步请求都够快（1s），完成不了加 loading 动画")])])]),t._v(" "),a("h3",{attrs:{id:"rail-测量模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rail-测量模型"}},[t._v("#")]),t._v(" RAIL 测量模型")]),t._v(" "),a("p",[t._v("谷歌提出来量化的一个测量标准，量化指标=>指导性的作用")]),t._v(" "),a("h4",{attrs:{id:"什么是-rail"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-rail"}},[t._v("#")]),t._v(" 什么是 RAIL？")]),t._v(" "),a("p",[t._v("就是一个标准，它告诉我们要做到什么程度，从用户角度出发")]),t._v(" "),a("ul",[a("li",[t._v("Response 响应")]),t._v(" "),a("li",[t._v("Animation 动画")]),t._v(" "),a("li",[t._v("Idle 空闲")]),t._v(" "),a("li",[t._v("Load 加载")])]),t._v(" "),a("h4",{attrs:{id:"rail-的目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rail-的目标"}},[t._v("#")]),t._v(" RAIL 的目标")]),t._v(" "),a("p",[t._v("让良好的用户体验成为性能优化的目标")]),t._v(" "),a("h4",{attrs:{id:"rail-评估标准"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rail-评估标准"}},[t._v("#")]),t._v(" RAIL 评估标准")]),t._v(" "),a("ul",[a("li",[t._v("响应：处理事件应在 50ms 以内完成")]),t._v(" "),a("li",[t._v("动画：每 10ms 产生一帧，1s60 帧，（6ms 绘制一帧）")]),t._v(" "),a("li",[t._v("空闲：尽可能增加空闲时间")]),t._v(" "),a("li",[t._v("加载：在 5s 内完成内容加载并可以交互")])]),t._v(" "),a("h3",{attrs:{id:"性能测量工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能测量工具"}},[t._v("#")]),t._v(" 性能测量工具")]),t._v(" "),a("ul",[a("li",[t._v("Chrome DevTools 开发调试、性能评测")]),t._v(" "),a("li",[t._v("Lighthouse 网站整体质量评估")]),t._v(" "),a("li",[t._v("WebPageTest 多测试地点、全面性能报告")])]),t._v(" "),a("h4",{attrs:{id:"使用-webpagetest-评估-web-网站性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-webpagetest-评估-web-网站性能"}},[t._v("#")]),t._v(" 使用 WebPageTest 评估 Web 网站性能")]),t._v(" "),a("h5",{attrs:{id:"解读-webpagetest-的报告"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解读-webpagetest-的报告"}},[t._v("#")]),t._v(" 解读 WebPageTest 的报告")]),t._v(" "),a("ul",[a("li",[t._v("waterfall chart 请求瀑布图")]),t._v(" "),a("li",[t._v("first view 首次访问")]),t._v(" "),a("li",[t._v("repeat view 二次访问")])]),t._v(" "),a("h5",{attrs:{id:"webpagetest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpagetest"}},[t._v("#")]),t._v(" WebPageTest")]),t._v(" "),a("ul",[a("li",[t._v("在线进行网站性能分析")]),t._v(" "),a("li",[t._v("如何本地部署 WebPageTest 工具")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打开命令行和终端，使用docker")]),t._v("\ndocker pull webpagetest/server\n\ndocker pull webpagetest/agent\n\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),t._v(":80 webpagetest/server\n\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4001")]),t._v(":80 --network"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SERVER_URL=http://localhost:4000/work/"')]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOCATION=Test"')]),t._v(" webpagetest/agent\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -----制作一个自定义镜像-----")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建一个文件夹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" wpt-mac-server\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" wpt-mac-server\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" Dockerfile\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 基于server镜像添加一个配置文件，会做一个自定义的修改，然后放到目录下")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# FROM webpagetest/server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ADD locations.ini /var/www/html/settings/")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" locations.ini\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [locations]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1=Test_loc")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [Test_loc]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1=Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# label=Test Location")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# group=Desktop")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [Test]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# browser=Chrome,Firefox")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# label="Test Location"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# connectivity=LAN")]),t._v("\n\ndocker build -t wpt-mac-server "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" wpt-mac-agent\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" wpt-mac-agent\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" Dockerfile\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# FROM webpagetest/agent")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ADD script.sh /")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ENTRYPOINT /script.sh")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" script.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# #!/bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# set -e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# if [ -z "$SERVER_URL" ]; then')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   echo >&2 'SERVER_URL not set'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   exit 1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# fi")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# if [ -z "$LOCATION" ]; then')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   echo >&2 "LOCATION not set"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   exit 1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# fi")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# EXTRA_ARGS=""')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# if [ -n "$NAME" ]; then')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   EXTRA_ARGS="$EXTRA_ARGS --name $NAME"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# fi")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# python /wptagent/wptagent.py --server $SERVER_URL --location $LOCATION $EXTRA_ARGS --xvfb --dockerized -vvvvv --shaper none")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 给脚本添加执行权限")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" u+x script.sh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像打包，自定义名称叫wpt-mac-agent")]),t._v("\ndocker build -t wpt-mac-agent "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker ps")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停掉镜像实例")]),t._v("\ndocker stop\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跑自定义镜像")]),t._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),t._v(":80 wpt-mac-server\n\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4001")]),t._v(":80 --network"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SERVER_URL=http://localhost:4000/work/"')]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOCATION=Test"')]),t._v(" wpt-mac-agent\n\n")])])]),a("h4",{attrs:{id:"使用-lighthouse-分析性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-lighthouse-分析性能"}},[t._v("#")]),t._v(" 使用 Lighthouse 分析性能")]),t._v(" "),a("p",[t._v("除了生成一个完整的报告,还可以提供建议。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -g lighthouse\n\nlighthouse http://www.bilibili.com\n")])])]),a("h4",{attrs:{id:"lighthouse-的安装及使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lighthouse-的安装及使用"}},[t._v("#")]),t._v(" Lighthouse 的安装及使用")]),t._v(" "),a("ul",[a("li",[t._v("本地 npm 安装 Lighthouse")]),t._v(" "),a("li",[t._v("Chrome DevTools 中使用")]),t._v(" "),a("li",[t._v("通过 chrome web store 安装插件")])]),t._v(" "),a("h2",{attrs:{id:"代码优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码优化"}},[t._v("#")]),t._v(" 代码优化")]),t._v(" "),a("h3",{attrs:{id:"js-优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-优化"}},[t._v("#")]),t._v(" JS 优化")]),t._v(" "),a("h3",{attrs:{id:"html-优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#html-优化"}},[t._v("#")]),t._v(" HTML 优化")]),t._v(" "),a("h3",{attrs:{id:"css-优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css-优化"}},[t._v("#")]),t._v(" CSS 优化")]),t._v(" "),a("h2",{attrs:{id:"渲染优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染优化"}},[t._v("#")]),t._v(" 渲染优化")]),t._v(" "),a("h3",{attrs:{id:"现代浏览器渲染原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#现代浏览器渲染原理"}},[t._v("#")]),t._v(" 现代浏览器渲染原理")]),t._v(" "),a("h3",{attrs:{id:"可优化的渲染环节和方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可优化的渲染环节和方法"}},[t._v("#")]),t._v(" 可优化的渲染环节和方法")]),t._v(" "),a("h2",{attrs:{id:"资源优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源优化"}},[t._v("#")]),t._v(" 资源优化")]),t._v(" "),a("h3",{attrs:{id:"压缩-合并"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#压缩-合并"}},[t._v("#")]),t._v(" 压缩&合并")]),t._v(" "),a("h3",{attrs:{id:"图片格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片格式"}},[t._v("#")]),t._v(" 图片格式")]),t._v(" "),a("h3",{attrs:{id:"图片加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片加载"}},[t._v("#")]),t._v(" 图片加载")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/Other/Performance/Lazy-load.html"}},[t._v("懒加载")])],1),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/Other/Performance/Pre-load.html"}},[t._v("预加载")])],1),t._v(" "),a("h3",{attrs:{id:"字体优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字体优化"}},[t._v("#")]),t._v(" 字体优化")]),t._v(" "),a("h2",{attrs:{id:"构建优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建优化"}},[t._v("#")]),t._v(" 构建优化")]),t._v(" "),a("h3",{attrs:{id:"webpack-的优化配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-的优化配置"}},[t._v("#")]),t._v(" webpack 的优化配置")]),t._v(" "),a("h3",{attrs:{id:"代码拆分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码拆分"}},[t._v("#")]),t._v(" 代码拆分")]),t._v(" "),a("h3",{attrs:{id:"代码压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码压缩"}},[t._v("#")]),t._v(" 代码压缩")]),t._v(" "),a("h3",{attrs:{id:"持久化缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持久化缓存"}},[t._v("#")]),t._v(" 持久化缓存")]),t._v(" "),a("h3",{attrs:{id:"检测与分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检测与分析"}},[t._v("#")]),t._v(" 检测与分析")]),t._v(" "),a("h3",{attrs:{id:"按需加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#按需加载"}},[t._v("#")]),t._v(" 按需加载")]),t._v(" "),a("h2",{attrs:{id:"传输加载优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传输加载优化"}},[t._v("#")]),t._v(" 传输加载优化")]),t._v(" "),a("h3",{attrs:{id:"gzip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gzip"}},[t._v("#")]),t._v(" Gzip")]),t._v(" "),a("p",[t._v("前端的压缩方式有很多，现在的一些 gulp、webpack 等，基本能压缩 50%以上，"),a("strong",[t._v("gzip 能在压缩的基础上再进行压缩 50%以上")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"gzip-压缩原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gzip-压缩原理"}},[t._v("#")]),t._v(" gzip 压缩原理")]),t._v(" "),a("p",[t._v("请求头中有个 Accept-Encoding 来标识对压缩的支持。客户端 http 请求头中声明浏览器支持的压缩方式，服务端配置启用压缩，压缩的文件类型，压缩方式。当客户端请求到服务端时，服务器解析请求头，如果客户端支持 gzip 压缩，响应时对请求的资源进行压缩并返回客户端，浏览器按照自己的方式解析，在 http 响应头，如果可以看到 content-encoding：gzip，这是指服务端使用了 gzip 的压缩方式。")]),t._v(" "),a("h4",{attrs:{id:"启用-gzip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启用-gzip"}},[t._v("#")]),t._v(" 启用 gzip")]),t._v(" "),a("p",[t._v("node 端很简单，只要加上 "),a("a",{attrs:{href:"https://github.com/expressjs/compression",target:"_blank",rel:"noopener noreferrer"}},[t._v("compress"),a("OutboundLink")],1),t._v(" 模块即可")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" compression "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"compression"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//尽量在其他中间件前使用compression")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("compression")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("这是基本用法，如果还要对请求进行过滤的话，还要加上")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("compression")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" shouldCompress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldCompress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x-no-compression"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里就过滤掉了请求头包含'x-no-compression'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" compression"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("koa")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" compress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"koa-compress"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("compress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("因为 node 读取的是生成目录中的文件，所以要先用 webpack 等其他工具进行压缩成 gzip，webpack 的配置如下")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" CompressionWebpackPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"compression-webpack-plugin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nplugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompressionWebpackPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    asset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[path].gz[query]"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目标文件名")]),t._v("\n    algorithm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gzip"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用gzip压缩")]),t._v("\n    test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\.(js|css)$"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 压缩 js 与 css")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    threshold"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10240")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 资源文件大于10240B=10kB时会被压缩")]),t._v("\n    minRatio"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最小压缩比达到0.8时才会被压缩")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("nginx")])]),t._v(" "),a("p",[t._v("gzip 使用环境:http,server,location,if(x),一般把它定义在 nginx.conf 的 http{…..}之间")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("gzip on")]),t._v(" "),a("p",[t._v("on 为启用，off 为关闭")])]),t._v(" "),a("li",[a("p",[t._v("gzip_min_length 1k")]),t._v(" "),a("p",[t._v("设置允许压缩的页面最小字节数，页面字节数从 header 头中的 Content-Length 中进行获取。默认值是 0，不管页面多大都压缩。建议设置成大于 1k 的字节数，小于 1k 可能会越压越大。")])]),t._v(" "),a("li",[a("p",[t._v("gzip_buffers 4 16k")]),t._v(" "),a("p",[t._v("获取多少内存用于缓存压缩结果，‘4 16k’表示以 16k*4 为单位获得")])]),t._v(" "),a("li",[a("p",[t._v("gzip_comp_level 5")]),t._v(" "),a("p",[t._v("gzip 压缩比（1~9），越小压缩效果越差，但是越大处理越慢，所以一般取中间值;")])]),t._v(" "),a("li",[a("p",[t._v("gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php\n对特定的 MIME 类型生效,其中'text/html’被系统强制启用")])]),t._v(" "),a("li",[a("p",[t._v("gzip_http_version 1.1")]),t._v(" "),a("p",[t._v("识别 http 协议的版本,早起浏览器可能不支持 gzip 自解压,用户会看到乱码")])]),t._v(" "),a("li",[a("p",[t._v("gzip_vary on")]),t._v(" "),a("p",[t._v('启用应答头"Vary: Accept-Encoding"')])]),t._v(" "),a("li",[a("p",[t._v("gzip_proxied off")]),t._v(" "),a("p",[t._v('nginx 做为反向代理时启用,off(关闭所有代理结果的数据的压缩),expired(启用压缩,如果 header 头中包括"Expires"头信息),no-cache(启用压缩,header 头中包含"Cache-Control:no-cache"),no-store(启用压缩,header 头中包含"Cache-Control:no-store"),private(启用压缩,header 头中包含"Cache-Control:private"),no_last_modefied(启用压缩,header 头中不包含"Last-Modified"),no_etag(启用压缩,如果 header 头中不包含"Etag"头信息),auth(启用压缩,如果 header 头中包含"Authorization"头信息)')])]),t._v(" "),a("li",[a("p",[t._v("gzip_disable msie6")]),t._v(" "),a("p",[t._v("(IE5.5 和 IE6 SP1 使用 msie6 参数来禁止 gzip 压缩 )指定哪些不需要 gzip 压缩的浏览器(将和 User-Agents 进行匹配),依赖于 PCRE 库")])])]),t._v(" "),a("p",[t._v("以上代码可以插入到 http {...}整个服务器的配置里，也可以插入到虚拟主机的 server {...}或者下面的 location 模块内")]),t._v(" "),a("h3",{attrs:{id:"keepalive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keepalive"}},[t._v("#")]),t._v(" KeepAlive")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/9fe2c140fa52",target:"_blank",rel:"noopener noreferrer"}},[t._v("KeepAlive 详解"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"http-缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-缓存"}},[t._v("#")]),t._v(" HTTP 缓存")]),t._v(" "),a("h3",{attrs:{id:"service-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-worker"}},[t._v("#")]),t._v(" Service Worker")]),t._v(" "),a("h3",{attrs:{id:"http-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-2"}},[t._v("#")]),t._v(" HTTP/2")]),t._v(" "),a("h3",{attrs:{id:"ssr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssr"}},[t._v("#")]),t._v(" SSR")]),t._v(" "),a("h3",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" Nginx")]),t._v(" "),a("h2",{attrs:{id:"更多流行优化技术"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更多流行优化技术"}},[t._v("#")]),t._v(" 更多流行优化技术")]),t._v(" "),a("h3",{attrs:{id:"svg-优化图标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#svg-优化图标"}},[t._v("#")]),t._v(" SVG 优化图标")]),t._v(" "),a("h3",{attrs:{id:"flexbox-布局"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flexbox-布局"}},[t._v("#")]),t._v(" FlexBox 布局")]),t._v(" "),a("p",[t._v("在早期的 CSS 布局方式中我们能对元素实行绝对定位、相对定位或浮动定位。而现在，我们有了新的布局方式 flexbox，它比起早期的布局方式来说有个优势，那就是性能比较好。")]),t._v(" "),a("h3",{attrs:{id:"预加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预加载"}},[t._v("#")]),t._v(" 预加载")]),t._v(" "),a("h3",{attrs:{id:"预渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预渲染"}},[t._v("#")]),t._v(" 预渲染")]),t._v(" "),a("h3",{attrs:{id:"窗口化提高列表性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#窗口化提高列表性能"}},[t._v("#")]),t._v(" 窗口化提高列表性能")]),t._v(" "),a("h3",{attrs:{id:"骨架组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#骨架组件"}},[t._v("#")]),t._v(" 骨架组件")])])}),[],!1,null,null,null);s.default=n.exports}}]);