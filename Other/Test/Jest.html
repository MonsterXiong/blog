<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jest | Monster</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/favicon.ico">
    <meta name="description" content="个人收藏夹">
    
    <link rel="preload" href="/assets/css/0.styles.ccbbb76c.css" as="style"><link rel="preload" href="/assets/js/app.51963213.js" as="script"><link rel="preload" href="/assets/js/2.d3d2c42b.js" as="script"><link rel="preload" href="/assets/js/259.f220aad5.js" as="script"><link rel="prefetch" href="/assets/js/10.26c993fa.js"><link rel="prefetch" href="/assets/js/100.4c3533ca.js"><link rel="prefetch" href="/assets/js/101.83f4c2fa.js"><link rel="prefetch" href="/assets/js/102.a68e5f2f.js"><link rel="prefetch" href="/assets/js/103.30e3f8ad.js"><link rel="prefetch" href="/assets/js/104.e1880ec5.js"><link rel="prefetch" href="/assets/js/105.edd46bf2.js"><link rel="prefetch" href="/assets/js/106.9afe0065.js"><link rel="prefetch" href="/assets/js/107.b27ec771.js"><link rel="prefetch" href="/assets/js/108.b61037b1.js"><link rel="prefetch" href="/assets/js/109.c172e4ec.js"><link rel="prefetch" href="/assets/js/11.0e8e41c3.js"><link rel="prefetch" href="/assets/js/110.b5f429dc.js"><link rel="prefetch" href="/assets/js/111.49dd6d9e.js"><link rel="prefetch" href="/assets/js/112.4c2fd181.js"><link rel="prefetch" href="/assets/js/113.efdd6a66.js"><link rel="prefetch" href="/assets/js/114.da2cae8a.js"><link rel="prefetch" href="/assets/js/115.67aa37ac.js"><link rel="prefetch" href="/assets/js/116.218d2a87.js"><link rel="prefetch" href="/assets/js/117.f1089a5c.js"><link rel="prefetch" href="/assets/js/118.75a378fc.js"><link rel="prefetch" href="/assets/js/119.46a07f3c.js"><link rel="prefetch" href="/assets/js/12.9bea25ca.js"><link rel="prefetch" href="/assets/js/120.42d8c42f.js"><link rel="prefetch" href="/assets/js/121.c2130312.js"><link rel="prefetch" href="/assets/js/122.393993ea.js"><link rel="prefetch" href="/assets/js/123.19f6914b.js"><link rel="prefetch" href="/assets/js/124.e19da728.js"><link rel="prefetch" href="/assets/js/125.1eea5b9b.js"><link rel="prefetch" href="/assets/js/126.bfb7f9e3.js"><link rel="prefetch" href="/assets/js/127.e3e8dd7f.js"><link rel="prefetch" href="/assets/js/128.769ec229.js"><link rel="prefetch" href="/assets/js/129.87cb8905.js"><link rel="prefetch" href="/assets/js/13.905fde5a.js"><link rel="prefetch" href="/assets/js/130.1e4a079b.js"><link rel="prefetch" href="/assets/js/131.962cd205.js"><link rel="prefetch" href="/assets/js/132.d0562ec3.js"><link rel="prefetch" href="/assets/js/133.d148ba67.js"><link rel="prefetch" href="/assets/js/134.00060a1d.js"><link rel="prefetch" href="/assets/js/135.762bedc2.js"><link rel="prefetch" href="/assets/js/136.40ae3720.js"><link rel="prefetch" href="/assets/js/137.fb298d3d.js"><link rel="prefetch" href="/assets/js/138.c1c84826.js"><link rel="prefetch" href="/assets/js/139.c80231ee.js"><link rel="prefetch" href="/assets/js/14.d242a799.js"><link rel="prefetch" href="/assets/js/140.4e8d6c1e.js"><link rel="prefetch" href="/assets/js/141.79feb0cf.js"><link rel="prefetch" href="/assets/js/142.3258ec18.js"><link rel="prefetch" href="/assets/js/143.398996fc.js"><link rel="prefetch" href="/assets/js/144.762572a3.js"><link rel="prefetch" href="/assets/js/145.7ad1e028.js"><link rel="prefetch" href="/assets/js/146.d978186d.js"><link rel="prefetch" href="/assets/js/147.37c6fbc7.js"><link rel="prefetch" href="/assets/js/148.599a5f59.js"><link rel="prefetch" href="/assets/js/149.450675fe.js"><link rel="prefetch" href="/assets/js/15.ce68cc14.js"><link rel="prefetch" href="/assets/js/150.5c90e277.js"><link rel="prefetch" href="/assets/js/151.b99bfd4f.js"><link rel="prefetch" href="/assets/js/152.de3c1075.js"><link rel="prefetch" href="/assets/js/153.3194fef9.js"><link rel="prefetch" href="/assets/js/154.bdf274cf.js"><link rel="prefetch" href="/assets/js/155.ac37a552.js"><link rel="prefetch" href="/assets/js/156.61e9d530.js"><link rel="prefetch" href="/assets/js/157.71861fb1.js"><link rel="prefetch" href="/assets/js/158.ff809b2b.js"><link rel="prefetch" href="/assets/js/159.f66a988b.js"><link rel="prefetch" href="/assets/js/16.b47ab1cb.js"><link rel="prefetch" href="/assets/js/160.1c9cf486.js"><link rel="prefetch" href="/assets/js/161.7e707b5a.js"><link rel="prefetch" href="/assets/js/162.98b088bd.js"><link rel="prefetch" href="/assets/js/163.cd3250f1.js"><link rel="prefetch" href="/assets/js/164.a567c478.js"><link rel="prefetch" href="/assets/js/165.4e9c624e.js"><link rel="prefetch" href="/assets/js/166.d182ed23.js"><link rel="prefetch" href="/assets/js/167.c01dce2e.js"><link rel="prefetch" href="/assets/js/168.abb64f0a.js"><link rel="prefetch" href="/assets/js/169.4455b779.js"><link rel="prefetch" href="/assets/js/17.59927b82.js"><link rel="prefetch" href="/assets/js/170.6106c644.js"><link rel="prefetch" href="/assets/js/171.dddf8d4a.js"><link rel="prefetch" href="/assets/js/172.d22915bd.js"><link rel="prefetch" href="/assets/js/173.9d3388a3.js"><link rel="prefetch" href="/assets/js/174.86a9ecc4.js"><link rel="prefetch" href="/assets/js/175.cca1f469.js"><link rel="prefetch" href="/assets/js/176.0c249788.js"><link rel="prefetch" href="/assets/js/177.b5de8cbd.js"><link rel="prefetch" href="/assets/js/178.27cfa270.js"><link rel="prefetch" href="/assets/js/179.413e87cc.js"><link rel="prefetch" href="/assets/js/18.7e7cf28d.js"><link rel="prefetch" href="/assets/js/180.759b9411.js"><link rel="prefetch" href="/assets/js/181.3a71051e.js"><link rel="prefetch" href="/assets/js/182.cbf716ab.js"><link rel="prefetch" href="/assets/js/183.aeb50482.js"><link rel="prefetch" href="/assets/js/184.29c69bd9.js"><link rel="prefetch" href="/assets/js/185.e51a3da4.js"><link rel="prefetch" href="/assets/js/186.18c287d3.js"><link rel="prefetch" href="/assets/js/187.4b6ff81c.js"><link rel="prefetch" href="/assets/js/188.ff9ceb16.js"><link rel="prefetch" href="/assets/js/189.2403c877.js"><link rel="prefetch" href="/assets/js/19.9b274655.js"><link rel="prefetch" href="/assets/js/190.99b0d1fb.js"><link rel="prefetch" href="/assets/js/191.20398c96.js"><link rel="prefetch" href="/assets/js/192.8a7996c0.js"><link rel="prefetch" href="/assets/js/193.859b0aa5.js"><link rel="prefetch" href="/assets/js/194.cfa3114d.js"><link rel="prefetch" href="/assets/js/195.7a0d211c.js"><link rel="prefetch" href="/assets/js/196.0ecc8a70.js"><link rel="prefetch" href="/assets/js/197.39d4896a.js"><link rel="prefetch" href="/assets/js/198.4c798790.js"><link rel="prefetch" href="/assets/js/199.d55261fa.js"><link rel="prefetch" href="/assets/js/20.cce3fd05.js"><link rel="prefetch" href="/assets/js/200.a049406f.js"><link rel="prefetch" href="/assets/js/201.f10653fb.js"><link rel="prefetch" href="/assets/js/202.f420cb56.js"><link rel="prefetch" href="/assets/js/203.e98347b7.js"><link rel="prefetch" href="/assets/js/204.f72d5b4f.js"><link rel="prefetch" href="/assets/js/205.58aef437.js"><link rel="prefetch" href="/assets/js/206.c923f761.js"><link rel="prefetch" href="/assets/js/207.d0ec7a5c.js"><link rel="prefetch" href="/assets/js/208.018e9653.js"><link rel="prefetch" href="/assets/js/209.dbce6a36.js"><link rel="prefetch" href="/assets/js/21.11cfa259.js"><link rel="prefetch" href="/assets/js/210.b37c9493.js"><link rel="prefetch" href="/assets/js/211.96988e7a.js"><link rel="prefetch" href="/assets/js/212.370f5382.js"><link rel="prefetch" href="/assets/js/213.a1b48312.js"><link rel="prefetch" href="/assets/js/214.7817a6b6.js"><link rel="prefetch" href="/assets/js/215.f4af78fb.js"><link rel="prefetch" href="/assets/js/216.a6d73e28.js"><link rel="prefetch" href="/assets/js/217.1b5f990e.js"><link rel="prefetch" href="/assets/js/218.05bb2023.js"><link rel="prefetch" href="/assets/js/219.f13be346.js"><link rel="prefetch" href="/assets/js/22.366f8c53.js"><link rel="prefetch" href="/assets/js/220.efecc1b4.js"><link rel="prefetch" href="/assets/js/221.0686f8ee.js"><link rel="prefetch" href="/assets/js/222.f4724858.js"><link rel="prefetch" href="/assets/js/223.1363290b.js"><link rel="prefetch" href="/assets/js/224.193196ad.js"><link rel="prefetch" href="/assets/js/225.326eef39.js"><link rel="prefetch" href="/assets/js/226.6cb29260.js"><link rel="prefetch" href="/assets/js/227.d227af20.js"><link rel="prefetch" href="/assets/js/228.70183150.js"><link rel="prefetch" href="/assets/js/229.e09f02e1.js"><link rel="prefetch" href="/assets/js/23.13e428f6.js"><link rel="prefetch" href="/assets/js/230.adb3547f.js"><link rel="prefetch" href="/assets/js/231.9d71788b.js"><link rel="prefetch" href="/assets/js/232.68a4a79a.js"><link rel="prefetch" href="/assets/js/233.adacbde2.js"><link rel="prefetch" href="/assets/js/234.72e40d86.js"><link rel="prefetch" href="/assets/js/235.64174a74.js"><link rel="prefetch" href="/assets/js/236.edf191aa.js"><link rel="prefetch" href="/assets/js/237.f52cf4fa.js"><link rel="prefetch" href="/assets/js/238.800dc15e.js"><link rel="prefetch" href="/assets/js/239.10d056f6.js"><link rel="prefetch" href="/assets/js/24.a75434a8.js"><link rel="prefetch" href="/assets/js/240.deed77e1.js"><link rel="prefetch" href="/assets/js/241.464e9bf0.js"><link rel="prefetch" href="/assets/js/242.7273d677.js"><link rel="prefetch" href="/assets/js/243.99fdcdc5.js"><link rel="prefetch" href="/assets/js/244.047fa678.js"><link rel="prefetch" href="/assets/js/245.bc611e24.js"><link rel="prefetch" href="/assets/js/246.bd893381.js"><link rel="prefetch" href="/assets/js/247.4b316a04.js"><link rel="prefetch" href="/assets/js/248.16c95d6a.js"><link rel="prefetch" href="/assets/js/249.489a221b.js"><link rel="prefetch" href="/assets/js/25.7c629b84.js"><link rel="prefetch" href="/assets/js/250.b8d57897.js"><link rel="prefetch" href="/assets/js/251.87cd587c.js"><link rel="prefetch" href="/assets/js/252.64208931.js"><link rel="prefetch" href="/assets/js/253.6d3b5f5e.js"><link rel="prefetch" href="/assets/js/254.c2d32b8e.js"><link rel="prefetch" href="/assets/js/255.515dad88.js"><link rel="prefetch" href="/assets/js/256.1df94050.js"><link rel="prefetch" href="/assets/js/257.0bb8f180.js"><link rel="prefetch" href="/assets/js/258.fc156d1e.js"><link rel="prefetch" href="/assets/js/26.13d5164c.js"><link rel="prefetch" href="/assets/js/260.f9aa733b.js"><link rel="prefetch" href="/assets/js/261.728e6974.js"><link rel="prefetch" href="/assets/js/262.9f5a41d6.js"><link rel="prefetch" href="/assets/js/263.5f9f4654.js"><link rel="prefetch" href="/assets/js/264.7155ed8c.js"><link rel="prefetch" href="/assets/js/265.cebcc996.js"><link rel="prefetch" href="/assets/js/266.78971ec0.js"><link rel="prefetch" href="/assets/js/267.35e0faf0.js"><link rel="prefetch" href="/assets/js/268.b4ccf3dd.js"><link rel="prefetch" href="/assets/js/27.194c4027.js"><link rel="prefetch" href="/assets/js/28.bfeb316f.js"><link rel="prefetch" href="/assets/js/29.65adeb4c.js"><link rel="prefetch" href="/assets/js/3.12c4eb56.js"><link rel="prefetch" href="/assets/js/30.91b0ba37.js"><link rel="prefetch" href="/assets/js/31.2b44dede.js"><link rel="prefetch" href="/assets/js/32.45e8e983.js"><link rel="prefetch" href="/assets/js/33.b9179deb.js"><link rel="prefetch" href="/assets/js/34.64bbbe88.js"><link rel="prefetch" href="/assets/js/35.46e9ec3d.js"><link rel="prefetch" href="/assets/js/36.ea0ca6d7.js"><link rel="prefetch" href="/assets/js/37.c8565b91.js"><link rel="prefetch" href="/assets/js/38.9b3567c5.js"><link rel="prefetch" href="/assets/js/39.69251b47.js"><link rel="prefetch" href="/assets/js/4.409d92c0.js"><link rel="prefetch" href="/assets/js/40.3b0f9976.js"><link rel="prefetch" href="/assets/js/41.268e2ee8.js"><link rel="prefetch" href="/assets/js/42.6cdee852.js"><link rel="prefetch" href="/assets/js/43.ccd86f85.js"><link rel="prefetch" href="/assets/js/44.d5aa9413.js"><link rel="prefetch" href="/assets/js/45.4982e424.js"><link rel="prefetch" href="/assets/js/46.bf810886.js"><link rel="prefetch" href="/assets/js/47.7ec8e205.js"><link rel="prefetch" href="/assets/js/48.58665ce3.js"><link rel="prefetch" href="/assets/js/49.b3dc7130.js"><link rel="prefetch" href="/assets/js/5.b1272c4d.js"><link rel="prefetch" href="/assets/js/50.04ca0c16.js"><link rel="prefetch" href="/assets/js/51.f4b2da0b.js"><link rel="prefetch" href="/assets/js/52.17519a17.js"><link rel="prefetch" href="/assets/js/53.b78b6830.js"><link rel="prefetch" href="/assets/js/54.ca2c50ff.js"><link rel="prefetch" href="/assets/js/55.c31ab05c.js"><link rel="prefetch" href="/assets/js/56.5c22b272.js"><link rel="prefetch" href="/assets/js/57.f352430d.js"><link rel="prefetch" href="/assets/js/58.3ad299f1.js"><link rel="prefetch" href="/assets/js/59.8780a57d.js"><link rel="prefetch" href="/assets/js/6.f48c38d5.js"><link rel="prefetch" href="/assets/js/60.1fe6825d.js"><link rel="prefetch" href="/assets/js/61.2a9797e9.js"><link rel="prefetch" href="/assets/js/62.3508bbc0.js"><link rel="prefetch" href="/assets/js/63.5dd3c7ec.js"><link rel="prefetch" href="/assets/js/64.f4ef7806.js"><link rel="prefetch" href="/assets/js/65.31325a9c.js"><link rel="prefetch" href="/assets/js/66.18715d65.js"><link rel="prefetch" href="/assets/js/67.45ed5066.js"><link rel="prefetch" href="/assets/js/68.bf97b711.js"><link rel="prefetch" href="/assets/js/69.3fca1c15.js"><link rel="prefetch" href="/assets/js/7.967862d3.js"><link rel="prefetch" href="/assets/js/70.a85182b0.js"><link rel="prefetch" href="/assets/js/71.dae87348.js"><link rel="prefetch" href="/assets/js/72.eb2f1490.js"><link rel="prefetch" href="/assets/js/73.81784cd9.js"><link rel="prefetch" href="/assets/js/74.df09c1ac.js"><link rel="prefetch" href="/assets/js/75.2b0ad4b6.js"><link rel="prefetch" href="/assets/js/76.66b47957.js"><link rel="prefetch" href="/assets/js/77.b62c7a01.js"><link rel="prefetch" href="/assets/js/78.28c5811a.js"><link rel="prefetch" href="/assets/js/79.95d475d5.js"><link rel="prefetch" href="/assets/js/8.673a7c19.js"><link rel="prefetch" href="/assets/js/80.2d75d773.js"><link rel="prefetch" href="/assets/js/81.cfda913f.js"><link rel="prefetch" href="/assets/js/82.9e763e4c.js"><link rel="prefetch" href="/assets/js/83.01d9915e.js"><link rel="prefetch" href="/assets/js/84.e226c26e.js"><link rel="prefetch" href="/assets/js/85.5d0b08f7.js"><link rel="prefetch" href="/assets/js/86.e830df14.js"><link rel="prefetch" href="/assets/js/87.3de70613.js"><link rel="prefetch" href="/assets/js/88.f8d2125b.js"><link rel="prefetch" href="/assets/js/89.0e7414a0.js"><link rel="prefetch" href="/assets/js/9.063ff9b8.js"><link rel="prefetch" href="/assets/js/90.38486cc7.js"><link rel="prefetch" href="/assets/js/91.f8e110f3.js"><link rel="prefetch" href="/assets/js/92.493e9700.js"><link rel="prefetch" href="/assets/js/93.5e93d215.js"><link rel="prefetch" href="/assets/js/94.3afd7f6b.js"><link rel="prefetch" href="/assets/js/95.2bbb27a0.js"><link rel="prefetch" href="/assets/js/96.aa439df5.js"><link rel="prefetch" href="/assets/js/97.962d08ca.js"><link rel="prefetch" href="/assets/js/98.e6b9d371.js"><link rel="prefetch" href="/assets/js/99.f7ed391d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccbbb76c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Monster</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Daily/" class="nav-link">
  😇 日常
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌈 CSS" class="dropdown-title"><span class="title">🌈 CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="🌈 CSS" class="mobile-dropdown-title"><span class="title">🌈 CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CSS/Introduce/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/CSS/Base/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/CSS/Structure/" class="nav-link">
  架构
</a></li><li class="dropdown-item"><!----> <a href="/CSS/Tools/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><h4>
          预处理
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CSS/Preprocessing/Less/" class="nav-link">
  Less
</a></li><li class="dropdown-subitem"><a href="/CSS/Preprocessing/Sass/" class="nav-link">
  Sass
</a></li><li class="dropdown-subitem"><a href="/CSS/Preprocessing/Stylus/" class="nav-link">
  Stylus
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🚀 JS" class="dropdown-title"><span class="title">🚀 JS</span> <span class="arrow down"></span></button> <button type="button" aria-label="🚀 JS" class="mobile-dropdown-title"><span class="title">🚀 JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/Base/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/ES@NEXT/" class="nav-link">
  ES@next
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Code/" class="nav-link">
  手撕代码
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/FP/" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><h4>
          Vue
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vuex/" class="nav-link">
  Vuex
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue Router/" class="nav-link">
  Vue Router
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue SSR/" class="nav-link">
  Vue SSR
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue CLI/" class="nav-link">
  Vue CLI
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue Loader/" class="nav-link">
  Vue Loader
</a></li></ul></li><li class="dropdown-item"><h4>
          React
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/React/React/" class="nav-link">
  React
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌇 工程化" class="dropdown-title"><span class="title">🌇 工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="🌇 工程化" class="mobile-dropdown-title"><span class="title">🌇 工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Engineering/Summary/" class="nav-link">
  概述
</a></li><li class="dropdown-item"><h4>
          编译构建
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Engineering/Babel/" class="nav-link">
  Babel
</a></li><li class="dropdown-subitem"><a href="/Engineering/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-subitem"><a href="/Engineering/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/Engineering/Rollup/" class="nav-link">
  Rollup
</a></li><li class="dropdown-subitem"><a href="/Engineering/Gulp/" class="nav-link">
  Gulp
</a></li><li class="dropdown-subitem"><a href="/Engineering/Grunt/" class="nav-link">
  Grunt
</a></li><li class="dropdown-subitem"><a href="/Engineering/Snowpack/" class="nav-link">
  Snowpack
</a></li><li class="dropdown-subitem"><a href="/Engineering/Parcel/" class="nav-link">
  Parcel
</a></li><li class="dropdown-subitem"><a href="/Engineering/SWC/" class="nav-link">
  SWC
</a></li><li class="dropdown-subitem"><a href="/Engineering/Esbuild/" class="nav-link">
  Esbuild
</a></li></ul></li><li class="dropdown-item"><h4>
          CI/CD
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Engineering/Github Action/" class="nav-link">
  Github Action
</a></li><li class="dropdown-subitem"><a href="/Engineering/Docker/" class="nav-link">
  Docker
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Engineering/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-subitem"><a href="/Engineering/Lerna/" class="nav-link">
  Lerna
</a></li><li class="dropdown-subitem"><a href="/Engineering/PackageManager/" class="nav-link">
  包管理器
</a></li><li class="dropdown-subitem"><a href="/Engineering/CLI/" class="nav-link">
  脚手架
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🎁 其它" class="dropdown-title"><span class="title">🎁 其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="🎁 其它" class="mobile-dropdown-title"><span class="title">🎁 其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Other/DataStructure/" class="nav-link">
  🛠 数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/Other/DesignModel/" class="nav-link">
  🖊 设计模式
</a></li><li class="dropdown-item"><!----> <a href="/Other/Internet/" class="nav-link">
  🔗 网络协议
</a></li><li class="dropdown-item"><!----> <a href="/Other/Performance/" class="nav-link">
  ⏳ 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/Other/Safe/" class="nav-link">
  🚨 安全
</a></li><li class="dropdown-item"><!----> <a href="/Other/Test/" class="nav-link router-link-active">
  💯 测试
</a></li><li class="dropdown-item"><!----> <a href="/Other/Interview/" class="nav-link">
  🀄 面试
</a></li><li class="dropdown-item"><!----> <a href="/Other/Window/" class="nav-link">
  💻 Window
</a></li><li class="dropdown-item"><!----> <a href="/Other/Linux/" class="nav-link">
  🖥 Linux
</a></li><li class="dropdown-item"><!----> <a href="/Other/Mock/" class="nav-link">
  ❌ Mock
</a></li><li class="dropdown-item"><!----> <a href="/Other/VScode/" class="nav-link">
  🆚 VScode
</a></li><li class="dropdown-item"><h4>
          📖 文档
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Other/Vuepress/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-subitem"><a href="/Other/Markdown/" class="nav-link">
  Markdown
</a></li><li class="dropdown-subitem"><a href="/Other/Plan/" class="nav-link">
  计划
</a></li><li class="dropdown-subitem"><a href="/Other/More/" class="nav-link">
  后续
</a></li></ul></li><li class="dropdown-item"><h4>
          🛢 数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Other/DataBase/MySQL/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/Other/DataBase/MongoDB/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-subitem"><a href="/Other/DataBase/Redis/" class="nav-link">
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>
          📲 应用
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Other/Application/MiniProgram/" class="nav-link">
  小程序
</a></li><li class="dropdown-subitem"><a href="/Other/Application/PC/" class="nav-link">
  PC
</a></li><li class="dropdown-subitem"><a href="/Other/Application/H5/" class="nav-link">
  H5
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/Code/" class="nav-link">
  👊源码
</a></div><div class="nav-item"><a href="https://monsterxiong.github.io/Node/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  😍 Node
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/MonsterXiong/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  👷GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Daily/" class="nav-link">
  😇 日常
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌈 CSS" class="dropdown-title"><span class="title">🌈 CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="🌈 CSS" class="mobile-dropdown-title"><span class="title">🌈 CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CSS/Introduce/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/CSS/Base/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/CSS/Structure/" class="nav-link">
  架构
</a></li><li class="dropdown-item"><!----> <a href="/CSS/Tools/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><h4>
          预处理
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CSS/Preprocessing/Less/" class="nav-link">
  Less
</a></li><li class="dropdown-subitem"><a href="/CSS/Preprocessing/Sass/" class="nav-link">
  Sass
</a></li><li class="dropdown-subitem"><a href="/CSS/Preprocessing/Stylus/" class="nav-link">
  Stylus
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🚀 JS" class="dropdown-title"><span class="title">🚀 JS</span> <span class="arrow down"></span></button> <button type="button" aria-label="🚀 JS" class="mobile-dropdown-title"><span class="title">🚀 JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/Base/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/ES@NEXT/" class="nav-link">
  ES@next
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Code/" class="nav-link">
  手撕代码
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/FP/" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><h4>
          Vue
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vuex/" class="nav-link">
  Vuex
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue Router/" class="nav-link">
  Vue Router
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue SSR/" class="nav-link">
  Vue SSR
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue CLI/" class="nav-link">
  Vue CLI
</a></li><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/Vue/Vue Loader/" class="nav-link">
  Vue Loader
</a></li></ul></li><li class="dropdown-item"><h4>
          React
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/FrameWork/React/React/" class="nav-link">
  React
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌇 工程化" class="dropdown-title"><span class="title">🌇 工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="🌇 工程化" class="mobile-dropdown-title"><span class="title">🌇 工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Engineering/Summary/" class="nav-link">
  概述
</a></li><li class="dropdown-item"><h4>
          编译构建
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Engineering/Babel/" class="nav-link">
  Babel
</a></li><li class="dropdown-subitem"><a href="/Engineering/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-subitem"><a href="/Engineering/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/Engineering/Rollup/" class="nav-link">
  Rollup
</a></li><li class="dropdown-subitem"><a href="/Engineering/Gulp/" class="nav-link">
  Gulp
</a></li><li class="dropdown-subitem"><a href="/Engineering/Grunt/" class="nav-link">
  Grunt
</a></li><li class="dropdown-subitem"><a href="/Engineering/Snowpack/" class="nav-link">
  Snowpack
</a></li><li class="dropdown-subitem"><a href="/Engineering/Parcel/" class="nav-link">
  Parcel
</a></li><li class="dropdown-subitem"><a href="/Engineering/SWC/" class="nav-link">
  SWC
</a></li><li class="dropdown-subitem"><a href="/Engineering/Esbuild/" class="nav-link">
  Esbuild
</a></li></ul></li><li class="dropdown-item"><h4>
          CI/CD
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Engineering/Github Action/" class="nav-link">
  Github Action
</a></li><li class="dropdown-subitem"><a href="/Engineering/Docker/" class="nav-link">
  Docker
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Engineering/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-subitem"><a href="/Engineering/Lerna/" class="nav-link">
  Lerna
</a></li><li class="dropdown-subitem"><a href="/Engineering/PackageManager/" class="nav-link">
  包管理器
</a></li><li class="dropdown-subitem"><a href="/Engineering/CLI/" class="nav-link">
  脚手架
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🎁 其它" class="dropdown-title"><span class="title">🎁 其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="🎁 其它" class="mobile-dropdown-title"><span class="title">🎁 其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Other/DataStructure/" class="nav-link">
  🛠 数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/Other/DesignModel/" class="nav-link">
  🖊 设计模式
</a></li><li class="dropdown-item"><!----> <a href="/Other/Internet/" class="nav-link">
  🔗 网络协议
</a></li><li class="dropdown-item"><!----> <a href="/Other/Performance/" class="nav-link">
  ⏳ 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/Other/Safe/" class="nav-link">
  🚨 安全
</a></li><li class="dropdown-item"><!----> <a href="/Other/Test/" class="nav-link router-link-active">
  💯 测试
</a></li><li class="dropdown-item"><!----> <a href="/Other/Interview/" class="nav-link">
  🀄 面试
</a></li><li class="dropdown-item"><!----> <a href="/Other/Window/" class="nav-link">
  💻 Window
</a></li><li class="dropdown-item"><!----> <a href="/Other/Linux/" class="nav-link">
  🖥 Linux
</a></li><li class="dropdown-item"><!----> <a href="/Other/Mock/" class="nav-link">
  ❌ Mock
</a></li><li class="dropdown-item"><!----> <a href="/Other/VScode/" class="nav-link">
  🆚 VScode
</a></li><li class="dropdown-item"><h4>
          📖 文档
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Other/Vuepress/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-subitem"><a href="/Other/Markdown/" class="nav-link">
  Markdown
</a></li><li class="dropdown-subitem"><a href="/Other/Plan/" class="nav-link">
  计划
</a></li><li class="dropdown-subitem"><a href="/Other/More/" class="nav-link">
  后续
</a></li></ul></li><li class="dropdown-item"><h4>
          🛢 数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Other/DataBase/MySQL/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/Other/DataBase/MongoDB/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-subitem"><a href="/Other/DataBase/Redis/" class="nav-link">
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>
          📲 应用
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Other/Application/MiniProgram/" class="nav-link">
  小程序
</a></li><li class="dropdown-subitem"><a href="/Other/Application/PC/" class="nav-link">
  PC
</a></li><li class="dropdown-subitem"><a href="/Other/Application/H5/" class="nav-link">
  H5
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/Code/" class="nav-link">
  👊源码
</a></div><div class="nav-item"><a href="https://monsterxiong.github.io/Node/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  😍 Node
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/MonsterXiong/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  👷GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Other/Test/" aria-current="page" class="sidebar-link">测试</a></li><li><a href="/Other/Test/Jest.html" aria-current="page" class="active sidebar-link">Jest</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#导学" class="sidebar-link">导学</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#jest-前端自动化测试框架基础入门" class="sidebar-link">Jest 前端自动化测试框架基础入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#自动化测试背景及原理" class="sidebar-link">自动化测试背景及原理</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#前端自动化测试框架-jest" class="sidebar-link">前端自动化测试框架 Jest</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#jest-修改自动化测试样例" class="sidebar-link">Jest 修改自动化测试样例</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#jest-简单配置" class="sidebar-link">jest 简单配置</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#jest-中的匹配器-matchers" class="sidebar-link">Jest 中的匹配器 matchers</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#命令行工具的使用" class="sidebar-link">命令行工具的使用</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#异步代码测试方法" class="sidebar-link">异步代码测试方法</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#jest-中的钩子函数" class="sidebar-link">Jest 中的钩子函数</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#钩子函数的作用域" class="sidebar-link">钩子函数的作用域</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#jest-中的-mock" class="sidebar-link">Jest 中的 Mock</a></li></ul></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#jest-难点进阶" class="sidebar-link">Jest 难点进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#snapshot-快照测试" class="sidebar-link">Snapshot 快照测试</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#mock-深入学习" class="sidebar-link">mock 深入学习</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#mock-timers" class="sidebar-link">mock timers</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#es6-类中的测试" class="sidebar-link">ES6 类中的测试</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#jest-中对-dom-节点操作的测试" class="sidebar-link">Jest 中对 DOM 节点操作的测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#vue-中的-tdd-与单元测试" class="sidebar-link">Vue 中的 TDD 与单元测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#什么是-tdd" class="sidebar-link">什么是 TDD？</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#vue-环境中配置-jest" class="sidebar-link">Vue 环境中配置 Jest</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#vtu-的配置及使用" class="sidebar-link">VTU 的配置及使用</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#使用-tdd-的方式开发-header-组件" class="sidebar-link">使用 TDD 的方式开发 Header 组件</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#header-组件样式新增及快照测试" class="sidebar-link">Header 组件样式新增及快照测试</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#通用代码提取封装" class="sidebar-link">通用代码提取封装</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#undolist-的实现" class="sidebar-link">UndoList 的实现</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#undolist-样式修饰及测试代码优化" class="sidebar-link">UndoList 样式修饰及测试代码优化</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#undolist-编辑功能实现" class="sidebar-link">UndoList 编辑功能实现</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#codecoverage-代码覆盖率" class="sidebar-link">CodeCoverage 代码覆盖率</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#章节小结" class="sidebar-link">章节小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#vue-中的-bdd-与集成测试" class="sidebar-link">Vue 中的 BDD 与集成测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#bdd-的概念以及-tdd-的对比" class="sidebar-link">BDD 的概念以及 TDD 的对比</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#使用-bdd-和集成测试进行-vuex-项目的测试" class="sidebar-link">使用 BDD 和集成测试进行 Vuex 项目的测试</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#异步测试" class="sidebar-link">异步测试</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#路由页面的代码组织" class="sidebar-link">路由页面的代码组织</a></li></ul></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#react-中的-tdd-与单元测试-x" class="sidebar-link">React 中的 TDD 与单元测试（x）</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#react-中的-bdd-与集成测试-x" class="sidebar-link">React 中的 BDD 与集成测试(x)</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#前端自动化测试的思考总结" class="sidebar-link">前端自动化测试的思考总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#前端自动化测试的优势" class="sidebar-link">前端自动化测试的优势</a></li><li class="sidebar-sub-header"><a href="/Other/Test/Jest.html#前端自动化测试的重要知识点" class="sidebar-link">前端自动化测试的重要知识点</a></li></ul></li></ul></li><li><a href="/Other/Test/Postman.html" class="sidebar-link">Postman</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jest"><a href="#jest" class="header-anchor">#</a> Jest</h1> <h2 id="导学"><a href="#导学" class="header-anchor">#</a> 导学</h2> <p>前端工程化</p> <ul><li>前端自动化测试</li> <li>高质量的代码设计</li> <li>高质量的代码实现</li></ul> <p>流行的开源库，框架，全都包含了大量的自动化测试的代码,开源的库需要稳定性，通过自动化测试保证</p> <ul><li>Loadsh</li> <li>Ant Design</li> <li>Vue</li> <li>React</li> <li>Echarts</li> <li>Redux</li></ul> <p>系统质量糟糕，针对核心流程去编写测试用例，从而去修改代码，相对于重构任务量就轻很多了</p> <p><strong>Automatic FrontEnd Testing 前端自动化测试</strong></p> <ul><li>修复时间少</li> <li>修复难度低</li></ul> <p><strong>Code Refactoring 代码重构</strong></p> <ul><li>修复时间长</li> <li>修复成本高</li> <li>业务很有可能废弃</li></ul> <p>灰度发布=&gt;局部验证 降低 bug 出现概率</p> <p>TS Flow EsLint StyleLint 也可以提高代码质量</p> <p>常用的单元测试、集成测试、E2E 测试、性能、压力、回归测试等</p> <h2 id="jest-前端自动化测试框架基础入门"><a href="#jest-前端自动化测试框架基础入门" class="header-anchor">#</a> Jest 前端自动化测试框架基础入门</h2> <h3 id="自动化测试背景及原理"><a href="#自动化测试背景及原理" class="header-anchor">#</a> 自动化测试背景及原理</h3> <p><strong>Jest：expect 实现原理：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 假设我又增加了一个multi方法</span>

<span class="token keyword">function</span> <span class="token function">multi</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 增加multi的时候一不小心改了minus，测试就通不过了</span>
<span class="token comment">// 这样就有一个回归测试的概念，编写了新的代码有没有影响到老的代码</span>

<span class="token comment">// 套路：预期结果是不是等于实际结果</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> expected <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!==</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">3 + 7 应该等于</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,但是结果却是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> expected <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">3 - 3 应该等于</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,但是结果却是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 抽离提出公共方法</span>

<span class="token keyword">function</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">toBe</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">actual</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!==</span> actual<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">预期值和实际值不相等预期</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>actual<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 结果却是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 以上代码结果一样，需要增加测试描述</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">desc<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>desc<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">通过测试</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>desc<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">没有通过测试 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试加法3+7&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试减法3-3&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>判断实际结果和预期结果是否相等来判断是否存在问题，通过额外的测试代码就可以在代码上线之前提前做测试，这些测试不是人肉点击，而是通过提前写好的代码帮我们运行，这就是前端自动化测试，这也是主流前端自动化测试框架 mocha 和 jest 的一些底层实现原理。</p></blockquote> <h3 id="前端自动化测试框架-jest"><a href="#前端自动化测试框架-jest" class="header-anchor">#</a> 前端自动化测试框架 Jest</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 对很多expect和一些机制进行扩充</span>
<span class="token comment">// ------主流的框架</span>
<span class="token comment">// Jasmine</span>
<span class="token comment">// Mocha+chai(扩充)</span>
<span class="token comment">// Jest</span>

<span class="token comment">// ------好的前端自动化测试框架框架应该具备</span>
<span class="token operator">-</span>性能 <span class="token operator">-</span> 功能 <span class="token operator">-</span> 易用性<span class="token punctuation">;</span>

<span class="token comment">// 学会一个其他都差不多</span>

<span class="token comment">// ------好用的点</span>

<span class="token comment">// 速度快</span>
<span class="token comment">// API简单</span>
<span class="token comment">// 易配置</span>
<span class="token comment">// 隔离性好</span>
<span class="token comment">// 监控模式</span>
<span class="token comment">// IDE整合</span>
<span class="token comment">// Snapshot</span>
<span class="token comment">// 多项目并行</span>
<span class="token comment">// 覆盖率</span>
<span class="token comment">// Mock丰富</span>

<span class="token comment">// 支持得非常好，后台前端项目都可以支持，还有很多插件结合使用enzyme测试React，VTU测试Vue</span>
Babel<span class="token punctuation">;</span>
TypeScript<span class="token punctuation">;</span>
node<span class="token punctuation">;</span>
React<span class="token punctuation">;</span>
Angular<span class="token punctuation">;</span>
Vue<span class="token punctuation">;</span>
</code></pre></div><h3 id="jest-修改自动化测试样例"><a href="#jest-修改自动化测试样例" class="header-anchor">#</a> Jest 修改自动化测试样例</h3> <p>单元测试相当于模块测试，集成测试相当于多个模块测试，所以必须有模块的概念</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> init -y
<span class="token function">yarn</span> <span class="token function">add</span> --dev jest
<span class="token comment"># 修改script</span>
<span class="token string">&quot;test&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;jest&quot;</span>
</code></pre></div><h3 id="jest-简单配置"><a href="#jest-简单配置" class="header-anchor">#</a> jest 简单配置</h3> <p>jest 本身是有默认配置的，修改配置，需要把配置项暴露出来。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 生成一个基础配置文件</span>
npx jest --init
<span class="token comment"># 自动生成代码测试覆盖率报告</span>
npx jest --coverage
</code></pre></div><p>node 下只认识 commonjs，无法测试 es module，所以需要使用 babel 转化一下</p> <h4 id="jest-与-babel-结合"><a href="#jest-与-babel-结合" class="header-anchor">#</a> jest 与 babel 结合</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 安装依赖</span>
<span class="token function">yarn</span> <span class="token function">add</span> --dev babel-jest @babel/core @babel/preset-env
<span class="token comment"># 新建配置文件.babelrc</span>
</code></pre></div><p>根据当前 node 的环境结合@babel/preset-env 对现在的代码进行转化，这样 node 就可以运行了，jest 也可以正常运行了</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;current&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="底层运行机制原理"><a href="#底层运行机制原理" class="header-anchor">#</a> 底层运行机制原理</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> run <span class="token builtin class-name">test</span>
<span class="token comment"># jest内部集成了一个插件jest(babel-jest)，会检查你是否安装了babel或者babel-core</span>
<span class="token comment"># 取.babelrc配置</span>
<span class="token comment"># 在运行测试之前，结合babel，先把你的代码做一次转化</span>
<span class="token comment"># 运行转化过的测试用例代码</span>
</code></pre></div><h3 id="jest-中的匹配器-matchers"><a href="#jest-中的匹配器-matchers" class="header-anchor">#</a> Jest 中的匹配器 matchers</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// 监听所有测试文件的变化</span>
<span class="token property">&quot;test&quot;</span><span class="token operator">:</span><span class="token string">&quot;jest --watchAll&quot;</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># object.is() ===</span>
toBe

<span class="token comment"># 测试内容</span>
toEqual

<span class="token comment"># 真假匹配器</span>
toBeNull
toBeUndefined
toBeDefind
toBeTruthy
toBeFalsy

<span class="token comment"># 取反not匹配器,以下两个相等</span>
.not.toBeFalsy<span class="token punctuation">(</span><span class="token punctuation">)</span>
toBeTruthy<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 数字相关匹配器</span>
toBeGreaterThan <span class="token comment">#大于</span>
toBeLessThan <span class="token comment">#小于</span>
toBeGreaterThanOrEqual <span class="token comment">#大于等于</span>
toBeLessThanOrEqual <span class="token comment">#小于等于</span>
toBeCloseTo <span class="token comment"># 计算浮点数</span>
expect<span class="token punctuation">(</span><span class="token number">0.1</span>+0.2<span class="token punctuation">)</span>.toEqual<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token comment"># 错误的</span>
expect<span class="token punctuation">(</span><span class="token number">0.1</span>+0.2<span class="token punctuation">)</span>.toBeCloseTo<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token comment"># 0.1+0.2接近于0.3</span>

<span class="token comment"># 字符串匹配器</span>
toMatch <span class="token comment"># 匹配</span>

<span class="token comment"># Array,Set</span>
toContain <span class="token comment"># 包含</span>

<span class="token comment"># 异常</span>
toThrow <span class="token comment">#抛出异常，toThrow('可以放匹配的异常内容'或者正则表达式)</span>
</code></pre></div><blockquote><p>可以使用不同的匹配器实现同样的效果</p></blockquote> <h3 id="命令行工具的使用"><a href="#命令行工具的使用" class="header-anchor">#</a> 命令行工具的使用</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># vscode</span>
ctrl+shift+p
<span class="token comment"># 输入</span>
<span class="token function">install</span> code <span class="token builtin class-name">command</span>
<span class="token comment"># code安装的作用，code .  打开切换</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>将不正确的修改正确，不希望重新跑一遍测试用例，只跑修改的测试用例
w: 按出指令
a: all模式
f: 只跑之前没通过的测试用例，再点f退出f模式
o：仅仅测试改变文件的测试，需要记录文件的改变，需要用git去记录代码的改变，跟上次提交对比
p：根据文件过滤
t：根据测试名字去过滤我们想要测试的测试用例
q：离开watch模式
enter
ctrl+c两次退出
<span class="token comment"># 直接进入o模式</span>
jest --watch
<span class="token comment"># 直接进入a模式</span>
jest --watchAll
</code></pre></div><h3 id="异步代码测试方法"><a href="#异步代码测试方法" class="header-anchor">#</a> 异步代码测试方法</h3> <p>两种案例：分别是 callback 和 promise</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> axios --save
</code></pre></div><h4 id="callback"><a href="#callback" class="header-anchor">#</a> Callback</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token comment">// 接收一个回调</span>
<span class="token keyword">export</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./fetchData&quot;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData返回结果为{success:true}&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这个测试用例中，如果url不存在，测试依然会通过，只要fetchData能够正常运行就代表测试用例通过了，里面代码没跑测试用例就结束了</span>
<span class="token comment">// 解决办法在测试用例第二个参数中，写个done参数</span>
<span class="token comment">// 只有调用done函数测试用例才结束</span>

<span class="token comment">// 回调类型异步函数的测试</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData返回结果为{success:true}&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 总结：当异步函数接收回调函数的形式的时候，需要传递done参数，在回调函数去执行done参数才代表测试结束了</span>
</code></pre></div><h4 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 请求结束后自己来处理,返回promise</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="方式-1"><a href="#方式-1" class="header-anchor">#</a> 方式 1</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./fetchData&quot;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData返回结果为{success:true}&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注意：返回的是promise的时候需要return一下</span>
  <span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData返回结果为404&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 需要执行一个expect</span>
  expect<span class="token punctuation">.</span><span class="token function">assertions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;404&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果不加expect.assertions(1)，正确请求数据不会走catch，也同样会通过测试用例，所以需要补充一句</span>
</code></pre></div><h5 id="方式-2"><a href="#方式-2" class="header-anchor">#</a> 方式 2</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./fetchData&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// expect(fetchData()).resolves返回的是fetchData()拿到的所有结果去匹配toMatchObject只要包含对象内容就可以了</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData返回结果为{success:true}&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 期望去取数据，取得的数据resolves,里面包含指定内容</span>
  <span class="token keyword">return</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toMatchObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData返回结果为404&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 期望去取数据，取得的数据rejects,抛出了异常</span>
  <span class="token keyword">return</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="方式-3"><a href="#方式-3" class="header-anchor">#</a> 方式 3</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./fetchData&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用async await，不需要return了</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData返回结果为{success:true}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toMatchObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData返回结果为404&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="方式-4"><a href="#方式-4" class="header-anchor">#</a> 方式 4</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>fetchData<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./fetchData'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fetchData返回结果为{success:true}'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 先获取数据</span>
   <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       success<span class="token operator">:</span><span class="token boolean">true</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 存在一个问题：如果返回结果正常，那么不会走catch,那就正常通过了，与实际不符，所以需要增加一句expect.assertions(1)</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fetchData返回结果为404'</span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    expect<span class="token punctuation">.</span><span class="token function">assertions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'Error： Request failed with status code'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="jest-中的钩子函数"><a href="#jest-中的钩子函数" class="header-anchor">#</a> Jest 中的钩子函数</h3> <blockquote><p>钩子函数指在 jest 执行过程的某些具体时刻会自动被 jest 调用的某些函数。</p></blockquote> <blockquote><p>4 个核心钩子函数</p> <p>beforeAll</p> <p>beforeEach</p> <p>afterEach</p> <p>afterAll</p></blockquote> <h4 id="案例一"><a href="#案例一" class="header-anchor">#</a> 案例一：</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">minusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">&quot;./Counter&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的addOne方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  counter<span class="token punctuation">.</span><span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的minusOne方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 还是同一个counter实例，所以肯定是0</span>
  counter<span class="token punctuation">.</span><span class="token function">minusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 存在问题：</span>
<span class="token comment">// 两个测试之间是相互影响的，都会用到counter实例</span>
<span class="token comment">// 在测试之前需要进行初始化的时候建议使用钩子函数</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">&quot;./Counter&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">// 在所有测试用例执行之前会调用beforeAll</span>
<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeAll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 我们希望每个counter都是一个全新的counter实例，不希望有依赖关系互相影响，</span>
<span class="token comment">// 每个测试用例执行之前都会让beforeEach执行一次</span>
<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeEach&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 每个测试用例执行之前都会让afterEach执行一次</span>
<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;afterEach&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等到所有测试用例都执行结束之后会调用afterAll</span>
<span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;afterAll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的addOne方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  counter<span class="token punctuation">.</span><span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的minusOne方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 新的实例，所以为-1</span>
  counter<span class="token punctuation">.</span><span class="token function">minusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="案例二"><a href="#案例二" class="header-anchor">#</a> 案例二：</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">minusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">minusTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">&quot;./Counter&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">// 在所有测试用例执行之前会调用beforeAll</span>
<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeAll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 我们希望每个counter都是一个全新的counter实例，不希望有依赖关系互相影响，</span>
<span class="token comment">// 每个测试用例执行之前都会让beforeEach执行一次</span>
<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeEach&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 每个测试用例执行之前都会让afterEach执行一次</span>
<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;afterEach&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等到所有测试用例都执行结束之后会调用afterAll</span>
<span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;afterAll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的addOne方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的addOne方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  counter<span class="token punctuation">.</span><span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的addTwo方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的addTwo方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  counter<span class="token punctuation">.</span><span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的minusOne方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的minusOne方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 新的实例，所以为-1</span>
  counter<span class="token punctuation">.</span><span class="token function">minusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的minusTwo方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的minusTwo方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  counter<span class="token punctuation">.</span><span class="token function">minusTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 存在问题：太臃肿，都在一个文件中</span>
</code></pre></div><h4 id="分组语法"><a href="#分组语法" class="header-anchor">#</a> 分组语法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">&quot;./Counter&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;测试增加相关的代码&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的addOne方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    counter<span class="token punctuation">.</span><span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的addTwo方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    counter<span class="token punctuation">.</span><span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;测试减少相关的代码&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的minusOne方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    counter<span class="token punctuation">.</span><span class="token function">minusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试Counter中的minusTwo方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    counter<span class="token punctuation">.</span><span class="token function">minusTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 默认相当于全局有一个describe</span>
</code></pre></div><h3 id="钩子函数的作用域"><a href="#钩子函数的作用域" class="header-anchor">#</a> 钩子函数的作用域</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一个describe在的钩子函数对它下面的所有测试用例都有效</span>
<span class="token comment">// 在内层也可以写钩子函数</span>

<span class="token comment">// 所有descript同步代码=&gt;外部beforeAll=&gt;[第一个decript内部beforeAll=&gt;外部beforeEach=&gt;内部beforeEach=&gt;addone=&gt;内部afterEach=&gt;外部afterEach=&gt;内部beforeEach=&gt;addTwo=&gt;内部afterEach=&gt;外部afterEach=&gt;内部的afterAll]=&gt;循环下一个decript中的测试用例=&gt;外部的afterAll</span>
<span class="token comment">// 由外到内</span>

test<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 单个测试用例的调试</span>
</code></pre></div><h3 id="jest-中的-mock"><a href="#jest-中的-mock" class="header-anchor">#</a> Jest 中的 Mock</h3> <ol><li>捕获函数的调用和返回结果，以及 this 和调用顺序</li> <li>它可以让我们自由的设置返回结果</li> <li>改变内部函数的实现</li></ol> <h4 id="存在问题"><a href="#存在问题" class="header-anchor">#</a> 存在问题</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">runCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 修改之后</span>
  <span class="token comment">// return callback()</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./demo&quot;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试runCallback&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">runCallback</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 测试无法通过，需要在函数代码中增加return</span>
<span class="token comment">// 实际上我不想修改原来函数的代码</span>
</code></pre></div><h4 id="作用案例"><a href="#作用案例" class="header-anchor">#</a> 作用案例</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">runCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// callback('abc')</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createObject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">classItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">new</span> <span class="token class-name">classItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./demo&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Mock用法</span>
<span class="token comment">// 只要func执行过了，就代表runCallback执行过了</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试runCallback&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// mock函数，捕获函数的调用，普通方法无法追溯调用的</span>
  <span class="token keyword">const</span> func <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">runCallback</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">runCallback</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 被调用了</span>
  <span class="token comment">// expect(func).toBeCalled()</span>
  <span class="token comment">// 调用了2次</span>
  <span class="token comment">// expect(func.mock.calls.length).toBe(2)</span>
  <span class="token comment">// 参数</span>
  <span class="token comment">// expect(func.mock.calls[0]).toEqual(['abc'])</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>mock<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// calls:被调用的情况</span>
  <span class="token comment">// [[],[]]，func被调用两次，传递的参数都是空的</span>

  <span class="token comment">// instances：实例this的指向</span>

  <span class="token comment">// invocationCallOrder：被调用的顺序</span>
  <span class="token comment">// [1，2，3] 按顺序执行的</span>

  <span class="token comment">// results：函数执行输出的结果（返回值）是什么</span>
  <span class="token keyword">const</span> func <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">456</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 模拟返回一次结果</span>
  <span class="token comment">// func.mockReturnValueOnce('a')</span>
  <span class="token comment">// 第二次</span>
  <span class="token comment">// func.mockReturnValueOnce('b')</span>
  <span class="token comment">// 链式调用</span>
  <span class="token comment">// func.mockReturnValueOnce('a').mockReturnValueOnce('b')</span>
  <span class="token comment">// 返回多次固定结果</span>
  <span class="token comment">// func.mockReturnValue('a')</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./demo&quot;</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试createObject&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> func <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">createObject</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>mock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一般来说在真实的项目里，在测试异步函数代码的时候不会真正的发送ajax去请求接口，如果有N测试用例多个接口情况，花费时间太多，我们只需要确保异步请求发送就可以了</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./demo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用jest对axios去做一个模拟，这样就不会去请求真正的数据了</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;axios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

test<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token string">&quot;测试getData&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 意思就是axios去发get请求的时候，去模拟请求成功结果是{data:'hello'}</span>
  axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// mockResolvedValueOnce()</span>
  <span class="token comment">// 这时候去调用axios的get方法的时候不会真实的去请求接口，而是会以后面的数据作为结果</span>
  <span class="token comment">// 这样就把异步获取数据的内容变成了同步准备的内容</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./demo&quot;</span><span class="token punctuation">;</span>

test<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token string">&quot;测试runCallback&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> func <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// func.mockReturnValue('Monster')</span>
  <span class="token comment">// 更底层的实现，mock函数模拟的是以下这个的实现</span>
  <span class="token comment">//  const func = jest.fn(()=&gt;{</span>
  <span class="token comment">//    console.log('11')</span>
  <span class="token comment">//    return 'Monster'</span>
  <span class="token comment">//})</span>
  <span class="token comment">//func.mockImplementation()等价于往jest.fn()里面传一个函数</span>
  func<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Monster&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// mockImplementationOnce() 比mockReturnValue强大的是还可以往里面再写逻辑</span>
  <span class="token comment">// mockReturnThis()</span>
  <span class="token function">runCallback</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">runCallback</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">runCallback</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// expect这样的语句在测试中叫断言，断定什么样的内容会有什么样的结果</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;Monster&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 额外的匹配符</span>
  <span class="token comment">// 每次调用的参数都是abc</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledWith</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="jest-难点进阶"><a href="#jest-难点进阶" class="header-anchor">#</a> Jest 难点进阶</h2> <h3 id="snapshot-快照测试"><a href="#snapshot-快照测试" class="header-anchor">#</a> Snapshot 快照测试</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">generateConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    server<span class="token operator">:</span> <span class="token string">&quot;http:localhost&quot;</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> generateConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../demo&quot;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试generrateConfig函数&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">generateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    server<span class="token operator">:</span> <span class="token string">&quot;http:localhost&quot;</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 问题：测试文件内容越来越多，改完代码就需要修改测试用例</span>
<span class="token comment">// 换个方法</span>
<span class="token comment">// 第一次并没有任何的快照，所以会生成一个快照，会把generateConfig生成的内容去保存到一个快照文件中</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试generrateConfig函数&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">generateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 测试配置文件非常好用，只要测试文件不变就可以一直通过</span>
<span class="token comment">// 如果改了配置项，Snapshot就会有问题，现在的快照跟上一次的快照不匹配，其实就是在提醒我们是不是要真的修改配置文件</span>
<span class="token comment">// 命令：</span>
<span class="token comment">// u更新，更新不通过的快照，老的快照就更新成了新的内容</span>
<span class="token comment">// s跳过</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试generrateAnotherConfig函数'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">generateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 假设我们改了第一个函数的内容，同时也改了第二个函数函数的内容</span>
<span class="token comment">// 两个测试用例就都无法通过</span>
<span class="token comment">// 按u两个都会被更新，从而通过了</span>
<span class="token comment">// i模式，交互式的一个个去提示做更新，最后按回车就回到上一个面板</span>


<span class="token comment">// 快照对配置文件和UI组件很好用</span>

<span class="token comment">// 如果配置文件里面的内容是动态的，那么每一次对上一次都对不上，就通不过了new Date()</span>
<span class="token comment">// 解决问题,快照里面的time是任意一个Date都可以，不需要和上次是一样的</span>
<span class="token comment">// 使用expect.any()</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试generrateConfig函数'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">generateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        time：expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span>
    <span class="token comment">// expect.any(Number)</span>
    <span class="token comment">// expect.any(String)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 行列的Snapshot</span>
<span class="token comment">// 1.npm install prettier --save</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试generrateAnotherConfig函数&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">generateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchInlineSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这时候生成的快照内容就在测试用例里面去</span>
</code></pre></div><h3 id="mock-深入学习"><a href="#mock-深入学习" class="header-anchor">#</a> mock 深入学习</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 假设后端返回的是'{</span>
<span class="token comment">// data:(function(){return '123'})()</span>
<span class="token comment">// }'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>fetchData<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../demo'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fetchData测试'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">eval</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 测试不通过</span>
<span class="token comment">// 真正做前端自动化测试的时候，不会真正发请求，而是模拟请求</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fetchData测试'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockReturnResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       data<span class="token operator">:</span><span class="token string">'(function(){return '</span><span class="token number">123</span><span class="token string">'})()'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">eval</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 除了上面这个方法的话，还有其他解决办法</span>
<span class="token comment">// 自己写一个函数去替代fetchData这个函数</span>
<span class="token comment">// 创建__mocks__目录，新建同名文件demo.js</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolved<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolved</span><span class="token punctuation">(</span> <span class="token string">'(function(){return '</span><span class="token number">123</span><span class="token string">'})()'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在测试用例中使用假的fetchData替换真的做测试，把异步代码的测试就改成了同步代码的测试</span>
<span class="token comment">// 让jest去模拟demo的内容，它会自动到__mocks__下面去demo.js去取</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;./demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../demo&quot;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;fetchData测试&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">eval</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这种模拟数据的形式就不是模拟axios库，而是在本地模拟demo下面的函数了</span>
<span class="token comment">// 取消对demo的模拟</span>
<span class="token comment">// jest.unmock('./demo')</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 修改jest的配置文件</span>
<span class="token comment">// automock:true</span>
<span class="token comment">// 就会先看目录下有没有__mocks__目录，有的话就会去找同名文件，用这个文件中的内容取替换真正的内容，如果没有那就无法模拟了</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;./demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fetchData<span class="token punctuation">,</span> getNumber <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./demo&quot;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;getNumber 测试&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通不过，不是一个函数</span>
<span class="token comment">// 原因是现在用的是mock的demo下的一个函数，而不会用真正demo.js的内容</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 我们希望异步函数去模拟，同步函数就用原来的同步函数去测试</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;./demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// fetchData是模拟的</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./demo&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// getNumber是来自真正的demo文件中的</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> getNumber <span class="token punctuation">}</span> <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">requireActual</span><span class="token punctuation">(</span><span class="token string">&quot;./demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>官方文档中的 API Mock 和 the Jest Object 查漏补缺</p> <h3 id="mock-timers"><a href="#mock-timers" class="header-anchor">#</a> mock timers</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> timer <span class="token keyword">from</span> <span class="token string">&quot;../timer&quot;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;test测试&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这个也会运行成功</span>
    <span class="token comment">// expect(2).toBe(1)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 回调函数的解决办法就是使用done</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;test测试&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 问题：等待时间太久</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> timer <span class="token keyword">from</span> <span class="token string">&quot;../timer&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 告诉jest，在下面的测试用例中只要看见setTimeout,setInterval的时候，用假的timers模拟</span>
jest<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;test测试&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 执行通不过，还是要等三秒之后才能执行</span>
  <span class="token comment">// useFakeTimers,runAllTimers配对使用的，去跳过timer等待时间</span>
  <span class="token comment">// runAllTimers可以让所有的定时器立即执行</span>
  jest<span class="token punctuation">.</span><span class="token function">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 问题：如果嵌套setTimeout呢？</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> timer <span class="token keyword">from</span> <span class="token string">&quot;../timer&quot;</span><span class="token punctuation">;</span>

jest<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;test测试&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  jest<span class="token punctuation">.</span><span class="token function">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2次</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 把所有timer都运行了</span>
<span class="token comment">// 如果我只想执行在当前即将要运行的timer，还没在任务队列中的timer不执行呢？</span>
<span class="token comment">// 只想执行外部的timer,不想执行内部的timer</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;test测试&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 只运行加入队列中的timer</span>
  jest<span class="token punctuation">.</span><span class="token function">runOnlyPendingTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这两个API有点难记，在jest22版本有新的API</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;test测试&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 让时间快进3秒就可以了</span>
  jest<span class="token punctuation">.</span><span class="token function">advanceTimersByTime</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 快进2秒不通过，快进4秒通过，快进6秒不通过，因为已经调用2次了</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//jest.advanceTimersByTime(3000)是在上一个advanceTimersByTime基础上计算的，其他的测试用例如果也有这样的代码的话，会形成依赖关系，所以需要用到beforeEach钩子函数</span>
<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 每次运行测试用例之前都重新初始化</span>
  jest<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>对函数做 mock 是希望函数是可以被追溯的</li> <li>ajax 请求</li> <li>定时器</li></ul> <p>只需保证流程是否能够走通</p> <h3 id="es6-类中的测试"><a href="#es6-类中的测试" class="header-anchor">#</a> ES6 类中的测试</h3> <h4 id="通过对类的-mock-理解单元测试和集成测试"><a href="#通过对类的-mock-理解单元测试和集成测试" class="header-anchor">#</a> 通过对类的 Mock 理解单元测试和集成测试</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Util</span> <span class="token punctuation">{</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 异常复杂</span>
  <span class="token punctuation">}</span>
  <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 异常复杂</span>
  <span class="token punctuation">}</span>
  <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 异常复杂</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Util<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Util <span class="token keyword">from</span> <span class="token string">&quot;../util.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Util</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试a方法&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// expect(util.a(1,2)).toBe('12')</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 首先创建一个实例，然后对实例的方法进行执行就可以对结果进行测试，比较简单</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Util <span class="token keyword">from</span> <span class="token string">&quot;../util&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">demoFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Util</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  util<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  util<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> demoFunction<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> demoFunction <span class="token keyword">from</span> '<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>demo
<span class="token comment">// 原理：</span>
<span class="token comment">// 会自动提高到第一行，所以我们可以手动写到第一行</span>
<span class="token comment">// 发现util.js是一个类，这样就会自动把类的构造函数和方法都会替换成jest.fn()</span>
<span class="token comment">// 就不再是异常复杂的util了，而是自动会做转换</span>
<span class="token comment">// const Util = jest.fn() Util.a= jest.fn() Util.b= jest.fn()</span>
<span class="token comment">// 都是jest.fn()，就可以做追溯了</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./util'</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试demoFunction'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 如果创建Util了实例，并且a,b方法都运行了，就证明运行成功了</span>
    <span class="token comment">// 异常复杂，可以会真实的去创建，我们实际不需要了解结果，做了什么事情，我们只要知道执行了就可以了</span>
    <span class="token comment">// 所以我们只要模拟，这样有利于性能</span>
    <span class="token function">demoFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./util'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> Util <span class="token keyword">from</span> <span class="token string">'./util'</span>
<span class="token keyword">import</span> demoFunction <span class="token keyword">from</span> '<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>demo

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试demoFunction'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">demoFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>Util<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Util<span class="token punctuation">.</span>mock<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>Util<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>Util<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 单元测试经常会看见mock，因为mock让我们引入的外部模块变得简单，让单元测试运行起来变得更加的快速，只对自己的功能点进行测试</span>
<span class="token comment">// 集成测试：对功能点下所有的模块，所有的依赖都做测试</span>
<span class="token comment">// 不去模拟Util，一起测试就是集成测试，模拟util，重点就测试demoFunction的一个单元测试</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 自定义模拟__ mocks__,可以进一步封装</span>

<span class="token keyword">const</span> Util <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;constructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Util</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>a <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
util<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>b <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Util<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 其他方法，不推荐</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./util,'</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> Util <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'constructor'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token class-name">Util</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>a <span class="token operator">=</span>jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    util<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>b <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Util<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="jest-中对-dom-节点操作的测试"><a href="#jest-中对-dom-节点操作的测试" class="header-anchor">#</a> Jest 中对 DOM 节点操作的测试</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> jquery --save
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">addDivTobody</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;div/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> addDivTobody<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> addDivTobody <span class="token keyword">from</span> <span class="token string">&quot;../demo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;测试dom操作，addDivTobody&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">addDivTobody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">addDivTobody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// document.getElementById什么的dom操作都可以使用</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 为什么可以Jest可以对dom可以操作呢</span>
<span class="token comment">// node不具备dom</span>
<span class="token comment">// jest在node环境下自己模拟了一套dom的api,jsDom</span>
</code></pre></div><h2 id="vue-中的-tdd-与单元测试"><a href="#vue-中的-tdd-与单元测试" class="header-anchor">#</a> Vue 中的 TDD 与单元测试</h2> <h3 id="什么是-tdd"><a href="#什么是-tdd" class="header-anchor">#</a> 什么是 TDD？</h3> <p><strong>Test Driven Development(TDD) 测试驱动的开发</strong></p> <p>TDD 的开发流程（Red-Green Development）</p> <ol><li>编写测试用例</li> <li>运行测试，测试用例无法通过测试</li> <li>编写代码，使测试用例通过测试</li> <li>优化代码，完成开发</li> <li>新增功能，重复上述步骤</li></ol> <p>TDD 的优势</p> <ol><li>长期减少回归 bug</li> <li>代码质量更好（组织，可维护性）</li> <li>测试覆盖率高</li> <li>错误测试代码不容易出现</li></ol> <h3 id="vue-环境中配置-jest"><a href="#vue-环境中配置-jest" class="header-anchor">#</a> Vue 环境中配置 Jest</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 安装vue脚手架工具</span>
<span class="token function">npm</span> i @vue/cli@3.8.4 -g

<span class="token comment"># 创建项目</span>
vue create project-name

<span class="token comment"># 问答环节</span>
<span class="token comment"># 手动配置</span>
Babel
CSS Pre-processors
Linter
Unit Testing
<span class="token comment"># stylus</span>
<span class="token comment"># ESLint Standard config</span>
<span class="token comment"># Lint on save &amp;&amp; Lint and fix on commit</span>
<span class="token comment"># Jest</span>
<span class="token comment"># in dedicated config filer 单独生成不同的配置文件</span>
<span class="token comment"># n 不保存</span>

<span class="token comment"># 运行项目</span>
<span class="token function">npm</span> run serve
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// jest配置内容讲解</span>
<span class="token comment">// 看看测试用例文件夹 tests</span>
<span class="token comment">// 脚本增加--watch</span>
<span class="token comment">// npm run test:unit</span>
<span class="token comment">// 选择a</span>

<span class="token comment">// 测试文件中有可能引入外部的模块,没有后缀 ，逐个查找</span>
moduleFileExtensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 模块的转化vue使用vue-jest,css图片字体使用jest-transform-stub静态资源没必要解析变成字符串就行了,jsx，js使用babel-jest转化</span>
tansform<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token comment">// 那些文件下的内容不需要被转化</span>
tansformIgnorePatterns<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/node_modules/&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 语法简写@，模块的映射，把别名映射到真正的文件上去</span>
moduleNameMapper<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token comment">//对vue做快照测试做存储的时候格式化</span>
snapshotSerializers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;jest-serializer-vue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 运行测试命令，去哪里找测试文件</span>
testMatch<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 在jest测试的时候，有一个虚拟的dom，jsDom,测试环境下模拟的浏览器地址是什么</span>
testURL<span class="token operator">:</span> <span class="token string">&quot;http://localhost&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 两个插件，方便使用jest，p可以过滤文件，上下鼠标选中它，交互式选择</span>
watchPlugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;jest-watch-typeahead/filename&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;jest-watch-typeahead/testname&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 官方文档configuring Jest了解</span>
<span class="token comment">// 自带git仓库</span>
<span class="token comment">// git branch lesson1</span>
<span class="token comment">// git checkout lesson</span>
<span class="token comment">// 可以合并为git checkout -b lesson1</span>
<span class="token comment">// git merge master</span>
<span class="token comment">// lesson1上的代码就和master一样了</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 手动搭建</span>
<span class="token function">npm</span> i jest
<span class="token comment"># 配置jest.config.js的配置文件</span>
<span class="token comment"># 安装第三方模块babel-jest vue-jest等等一系列模块</span>
</code></pre></div><h3 id="vtu-的配置及使用"><a href="#vtu-的配置及使用" class="header-anchor">#</a> VTU 的配置及使用</h3> <p><a href="https://vue-test-utils.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">VTU 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># git checkout -b lesson2</span>
<span class="token comment"># git merge lesson1</span>
<span class="token comment"># 清空App.vue,assets的图片，Helloworld组件内容</span>
<span class="token comment"># 启动服务器</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// example.spec.js修改为HelloWorld.test.js</span>
<span class="token comment">// 第一种方式</span>
<span class="token comment">// 去修改jest中testMatch ,增加test</span>

<span class="token comment">// test目录修改为__tests__以及所有的目录下</span>
<span class="token comment">//  testMatch: [</span>
<span class="token comment">//    '**/__tests__/**/*.(js|jsx|ts|tsx)'</span>
<span class="token comment">//  ]</span>

<span class="token comment">// .eslintrc.js移到__test__目录下</span>
<span class="token comment">// 修改jest配置文件</span>
<span class="token comment">// testPathIgnorePatterns:[</span>
<span class="token comment">// '\.eslintrc\.js'</span>
<span class="token comment">// ]</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;HelloWorld.vue&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;renders props.msg when passed&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    root<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">&quot;@/components/HelloWorld.vue&quot;</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;HelloWorld.vue&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;renders props.msg when passed&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    root<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token function">h</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          props<span class="token operator">:</span> <span class="token punctuation">{</span>
            msg<span class="token operator">:</span> <span class="token string">&quot;Monster&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 局限性：我想看一下组件渲染过程结束之后的属性，data,props是否是正确的,只能测试UI展现上的一些东西，而且编写也不是那么快捷</span>
<span class="token comment">// 所以官方提供一个@vue/test-utils库</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">&quot;@/components/HelloWorld.vue&quot;</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;HelloWorld.vue&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;renders props.msg when passed&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">&quot;new message&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// shallowMount,渲染一个HelloWorld浅渲染，只渲染HelloWorld，不渲染子组件，性能就比较高，所以shallowMount常见于但与测试</span>
    <span class="token comment">// mount适合集成测试</span>
    <span class="token comment">// wrapper会有很多方法</span>
    <span class="token comment">// wrapper.findAll('.mmm')</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      propsData<span class="token operator">:</span> <span class="token punctuation">{</span> msg <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 快照测试,及时捕获UI的变化</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;组件渲染正常&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span> msg<span class="token operator">:</span> <span class="token string">&quot;Monster&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="使用-tdd-的方式开发-header-组件"><a href="#使用-tdd-的方式开发-header-组件" class="header-anchor">#</a> 使用 TDD 的方式开发 Header 组件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src下创建containers文件夹，页面级别的东西</span>

<span class="token comment">// 在containers文件夹下TodoList/TodoList.vue</span>

<span class="token comment">// 在app中引入</span>

<span class="token comment">// __tests__目录移动到TodoList文件夹下</span>

<span class="token comment">// 修改对应的测试文件内容</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TDD先写测试用例</span>
<span class="token comment">// TODOList查看页面了解功能 http://www.todolist.cn/</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMonut <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">&quot;@/components/Header.vue&quot;</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;Header 包含input框&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 为了测试与业务解耦，一般做法</span>
  <span class="token comment">// 测试用例肯定通不过，还没有开发业务代码，接着就需要去完善代码，从而通过测试用例</span>
  <span class="token comment">// 先想好测试怎么写再完善代码</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;input&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;Header 中 input 框初始内容为空&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inputValue <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>inputValue<span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;Header 中 input发生变化，数据应该跟着变&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;input&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">&quot;Monster&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inputValue <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>inputValue<span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;Monster&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;Header 中 input 框输入回车，无内容时，无反应&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;input&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 什么内容都没有输入的时候</span>
  input<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// input触发，用enter键</span>
  input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;keyup.enter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 按了回车没有向父组件触发事件就是成功的</span>
  <span class="token comment">// 就是说不应该向外去触发一个事件</span>
  <span class="token comment">// 先写成truthy,完善UI之后，再改为Falsy</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;Header 中 input 框输入回车，有内容时,向外触发事件,同时清空inputValue&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;input&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">&quot;Monster&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;keyup.enter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">data-test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!--
	1. 先搞个输入框 
	2. 绑定value
	3. 双向绑定v-model
	4. 子组件触发，无内容就不要告诉父组件 @keyup.enter=&quot;addTodoItem&quot;,
	addTodoItem(){this.$emit('add',this.inputValue)}
	4.1 所以需要增加一个判断if(this.inputValue){},有内容才去触发
	5. 写个反面，用来兼顾有内容无内容的情况，同时清空inputValue
	6. 在TodoList上引入Header组件，通过TDD写的应该没什么问题

Header在UI展示和使用上面都没什么问题，TDD开发Header完了

TDD开发思想：先去想清楚代码怎么写要怎么做，把测试用例写出来，然后围绕测试用例再去写代码
TDD带来的好处：让我们写代码之前先去思考再去写，所以可以有效的提高我们的代码质量
--&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMonut <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">&quot;@/components/TodoList.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">&quot;@/components/Header.vue&quot;</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;TodoItem 初始化时，undoList应该为空&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> undoList <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 集成测试：通过header操作，去看todoLsit的反应</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;TodoItem 监听到Header的add事件时，会增加一个内容&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">&quot;Monster&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// const input =header.find('[data-test=&quot;input&quot;]')</span>
  <span class="token comment">// input.setValue('Monster')</span>
  <span class="token comment">// input.trigger('keyup.enter')</span>
  header<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 触发方法</span>
  <span class="token comment">// wrapper.vm.addUndoItem('Monster')</span>
  <span class="token keyword">const</span> undoList <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 单元测试</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;TodoList中handleAddItem方法被调用时，UndoList列表内容会增加一个&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    undoList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">handleAddItem</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!--
对TodoList组件进行TDD开发

	1. 首先应该有个UndoList数组，存放未完成的事项
	2. 执行addItem,增加内容，但不是对的，我们希望的不是手动增加，而是Header触发input事件的时候，然后往我的事件中增加一项
	3. 可以在TodoList遍历以下数据看一下效果
--&gt;</span>
</code></pre></div><h3 id="header-组件样式新增及快照测试"><a href="#header-组件样式新增及快照测试" class="header-anchor">#</a> Header 组件样式新增及快照测试</h3> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">*</span> <span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #cdcdcd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.header</span> <span class="token punctuation">{</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.header-content</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.header-input</span> <span class="token punctuation">{</span>
  <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
  <span class="token property">text-indent</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> run lint --fix
<span class="token function">npm</span> run serve
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Header样式和功能的快照</span>
<span class="token comment">// 只要对UI或者逻辑做了修改，就会提醒了，确认无问题就可以更新</span>
<span class="token comment">// 不发生变化，发生变化可以提示我们</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;Header样式发生改变做提示&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="通用代码提取封装"><a href="#通用代码提取封装" class="header-anchor">#</a> 通用代码提取封装</h3> <p>在 Vue 中对通用代码封装</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 找子的data-test</span>
<span class="token comment">// utils/testUtils.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">findTestWrapper</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">wrapper<span class="token punctuation">,</span> tag</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> wrapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[data-test=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>测试用例的代码比我的 Header 组件的代码还要多，测试用例和代码都是 50 多行，增加了很多的开发成本。</p> <p>举例：复杂系统：这样的系统开发比较渣的话，会担心影响老的功能，每次都会做大量的回归测试，核心流程上的代码会写单元测试或者流程测试，引入自动化测试，就不需要重新做手动测试了，耗费了一定的编码时间，节约了大量的回归测试时间。</p> <h3 id="undolist-的实现"><a href="#undolist-的实现" class="header-anchor">#</a> UndoList 的实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;UndoList参数为[],count值应该为0，且列表无内容&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> countElem <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>countElem<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;UndoList参数为[1,2,3],count值应该为3，且列表有内容&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> countElem <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>countElem<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;UndoList参数为[1,2,3],count值应该为3，且列表有内容，且存在删除按钮&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> countElem <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deleteButtons <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;delete-button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>countElem<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>deleteButtons<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;UndoList删除按钮被点击时，向外触发删除事件&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deleteButtons <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;delete-button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  deleteButtons<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!--
	1. count区域，list.length
	2.item区域， ul-li
	3. 删除按钮
	4. 绑定事件handleDelete，触发delete事件，传入index过去
	5. todoList调用undoList,传入list以及监听delete
	6. handleDelteItem this.undoList.splice(index,1)
--&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 监听delete事件比较难写</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;TodoList调用UndoList，应该传递list参数&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> undoList <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> undoList<span class="token punctuation">.</span><span class="token function">props</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;TodoList中handleDelteItem方法被调用时，UndoList列表内容会减少一个&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    undoList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">handleDelteItem</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="undolist-样式修饰及测试代码优化"><a href="#undolist-样式修饰及测试代码优化" class="header-anchor">#</a> UndoList 样式修饰及测试代码优化</h3> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.undolist</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.title</span> <span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 10px 0<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.count</span> <span class="token punctuation">{</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #e6e6e6<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">font-szie</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.list</span> <span class="token punctuation">{</span>
  <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.item</span> <span class="token punctuation">{</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">border-left</span><span class="token punctuation">:</span> 5px solid #629a9a<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">text-indent</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.delete</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
  <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #e6e6e6<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">font-szie</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
  <span class="token property">text-indent</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试文件优化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMonut <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">&quot;@/components/TodoList.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">&quot;@/components/Header.vue&quot;</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;TodoList组件&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;初始时，undoList应该为空&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> undoList <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 集成测试：通过header操作，去看todoLsit的反应</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;监听到Header的add事件时，undoList会增加一个内容&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">&quot;Monster&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// const input =header.find('[data-test=&quot;input&quot;]')</span>
    <span class="token comment">// input.setValue('Monster')</span>
    <span class="token comment">// input.trigger('keyup.enter')</span>
    header<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 触发方法</span>
    <span class="token comment">// wrapper.vm.addUndoItem('Monster')</span>
    <span class="token keyword">const</span> undoList <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 单元测试</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;handleAddItem执行时，UndoList列表内容会增加一个&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      undoList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">handleAddItem</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 监听delete事件比较难写</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;使用UndoList组件，应该传递list参数&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> undoList <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> undoList<span class="token punctuation">.</span><span class="token function">props</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;handleDelteItem执行时，UndoList列表内容会减少一个&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      undoList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">handleDelteItem</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Header 组件，UndoList 组件都可以做对应的优化，使用 describe 描述，case 都放进去</p> <h3 id="undolist-编辑功能实现"><a href="#undolist-编辑功能实现" class="header-anchor">#</a> UndoList 编辑功能实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 点击正在运行时的就会变成input状态</span>
<span class="token comment">// 数据结构发生变化{status:'input',value:1}</span>
<span class="token comment">// TDD方式，这时候需要先去修改Header测试文件，不需要变更</span>
<span class="token comment">// TodoList测试文件修改，组件对应修改，这时候页面有问题，展示区域，所以需要去调整UndoList.vue</span>
<span class="token comment">// 通过变更流程，当项目采用TDD和单元测试的时候，需要先去改测试用例，再去改业务逻辑，两遍的工作，原因：测试代码和业务组件是有耦合的，测试的代码依赖于组件里面undolist的数据，数据存在耦合，所以需要两遍的工作</span>
<span class="token comment">// 业务逻辑的开发，TDD+单元测试并不是一个好的组合，先去写测试再写开发，还存在耦合</span>
<span class="token comment">// 函数组件库，如loadsh，测试用例和函数实现不会有太多的耦合，只要给入参，判断结果就行，就不会存在这种问题</span>

<span class="token comment">// TodoList减少功能也需要修改</span>
<span class="token comment">// 再检查undolit测试文件，修改数据结构中的list即可</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 单元测试</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;handleAddItem执行时，UndoList列表内容会增加一个&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    undoList<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">handleAddItem</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;handleDelteItem执行时，UndoList列表内容会减少一个&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    undoList<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">handleDelteItem</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>undoList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 功能实现</span>
<span class="token comment">// UndoList</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;列表项被点击，向外触发status事件&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deleteButton <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  deleteButton<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>status<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!--
	1. 绑定事件，changeIndex(index),this.$emit('status',index)
	2. 修改TodoList测试用例以及业务代码
	3. UndoList测试用例修改以及修改业务代码
	4. TodoList监听
	5. Undolist失去焦点时，status状态清空
	6. TodoList的用例,再去修改业务逻辑
	7. Undolist输入框变化时，业务代码：(e.target.value,index)
	8. TodoList测试用例修改，业务逻辑修改，监听事件需要及时补充，TDD没测试
	9. UndoList修改样式
--&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TodoList.test.js</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;changeStatus方法执行时，UndoList内容变化&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    list<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">handleStatusItem</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;resetStatus方法执行时，UndoList内容变化&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    list<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">resetStatus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;changeItemvalue方法执行时，UndoList内容变化&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    list<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">changeItemvalue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token string">&quot;444&quot;</span><span class="token punctuation">,</span>
    index<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;444&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// UndoList.js</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;列表项显示一个输入框，两个正常内容&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 能够获取到DOM节点</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// expect(wrapper.emitted().status).toBeTruthy()</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;失去焦点时，向外触发reset事件&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inputElem <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  inputElem<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;blur&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;输入框变化时，向外触发change事件&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UndoList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inputElem <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  inputElem<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>change<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>change<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>
    index<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 缺陷还是挺明显的</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.input</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 22px<span class="token punctuation">;</span>
  <span class="token property">text-indent</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 460px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="codecoverage-代码覆盖率"><a href="#codecoverage-代码覆盖率" class="header-anchor">#</a> CodeCoverage 代码覆盖率</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 删除node_modules</span>
<span class="token comment">// 重新安装依赖</span>
<span class="token comment">// 运行测试，会报错</span>
<span class="token comment">// 修改将vm.$data.xxx改为vm.xxx</span>
<span class="token comment">// vue文件样式如果没有要有个空行</span>
<span class="token comment">// input的样式名字也需要更改user-input</span>
<span class="token comment">// UndoList.js 输入框变化时，向外触发change事件 的expect报错，需要打印wrapper.emitted().change[0][0]，获取结果复制粘贴到expect的toEqual</span>
</code></pre></div><p>测试覆盖率</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// jest.config.js</span>
<span class="token comment">// 测试代码覆盖了多少业务代码的逻辑，任何目录下的js和vue除了node_modules</span>
<span class="token string">&quot;collectCoverageFrom&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;**/*.{js,vue}&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;!**/node_modules/**&quot;</span><span class="token punctuation">]</span>

<span class="token comment">// package.json增加脚本</span>
<span class="token string">&quot;test:cov&quot;</span><span class="token operator">:</span><span class="token string">&quot;vue-cli-service test:unit --coverage&quot;</span>

<span class="token comment">// .gitignore</span>
coverage
</code></pre></div><p>通过 Code Coverage 发现，当我们使用单元测试对我们的项目进行测试的时候，测试覆盖率非常的高，先写测试代码再写的逻辑，但是 TDD 存在的问题就是业务与测试耦合</p> <h3 id="章节小结"><a href="#章节小结" class="header-anchor">#</a> 章节小结</h3> <p>TDD 和单元测试不是一定要结合在一起使用的</p> <p>尝试过 TDD 和单元测试以及 TDD 和集成测试都尝试过</p> <p>TDD 代码质量提高</p> <p>单元测试 测试覆盖率高 业务耦合度高 代码量大 过于独立</p> <p>几个单元放在一起不确定能不能运行，只能保证单个是可以使用的</p> <p>最佳实践就是函数库</p> <p>BDD 用户行为的驱动 以及集成测试（针对一堆东西测）</p> <h2 id="vue-中的-bdd-与集成测试"><a href="#vue-中的-bdd-与集成测试" class="header-anchor">#</a> Vue 中的 BDD 与集成测试</h2> <h3 id="bdd-的概念以及-tdd-的对比"><a href="#bdd-的概念以及-tdd-的对比" class="header-anchor">#</a> BDD 的概念以及 TDD 的对比</h3> <p>BDD （Behavior Driven Development） 行为驱动开发</p> <p>先写代码再写测试</p> <p>采用 BDD，用户先开发一个功能，先写代码，基于用户想怎么测试，再写测试用例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 不去想测试，先写业务代码</span>
<span class="token comment">// 启动服务器</span>
<span class="token comment">// 基于用户行为</span>
<span class="token comment">// test下创建文件夹integration集成测试</span>
<span class="token comment">// 是在header里面输入然后undolist展示的</span>
<span class="token comment">// 用户行为是什么样的，那些行为是重要的</span>
<span class="token comment">// 123，点回车，就显示在正在运行中，这就是一个比较基础必须好用的行为，</span>
<span class="token comment">// 通过用户的行为去编写一个测试用例，我们把这个用户的行为过程叫story，story就是一个故事，当我们编写BDD的测试用例的时候实际上是结合story去编写的，这些是专业术语，记以下就好</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>mount<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>findTestWrapper <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../utils/testUtils'</span>
<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">'../../TodoList'</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
	1. 用户会在header输入框输入内容
	2. 用户会点击回车按钮
	3.列表项应该增加用户输入内容的列表项
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 现在不能用shallowMount了，是多个组件一起测试，用mount做一个深渲染，把组件树都渲染出来</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span>
    <span class="token keyword">const</span> inputElem <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span><span class="token string">'header-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'Monster'</span>
    inputElem<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    inputElem<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span>
    inputElem<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keyup.enter'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span><span class="token string">'list-item'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 流程：</span>
<span class="token comment">// 1.首先我们会先去写业务代码，不关心测试</span>
<span class="token comment">// 2.接着我们会去想用户的行为是怎么样的，然后接着写一个story，去描述用户的行为</span>
<span class="token comment">// 3.然后我们模拟用户的行为去做测试</span>

<span class="token comment">// package.json 修改脚本</span>
<span class="token string">&quot;test:integration&quot;</span><span class="token operator">:</span><span class="token string">&quot;vue-cli-service test:unit --watch&quot;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TDD</span>
<span class="token comment">// 1.先写测试再写代码</span>
<span class="token comment">// 2.一般结合单元测试使用，是白盒测试</span>
<span class="token comment">// 3.测试重点在代码</span>
<span class="token comment">// 4.安全感低</span>
<span class="token comment">// 5.速度快</span>

<span class="token comment">// 看着代码测试，是白盒测试，我们知道代码是怎么实现的</span>
<span class="token comment">// 单个组件测试，组装到一起不确定能否使用，安全感低</span>
<span class="token comment">// shallowMount浅渲染速度快</span>

<span class="token comment">// BDD</span>
<span class="token comment">// 1.先写代码再写测试</span>
<span class="token comment">// 2.一般结合集成测试使用，是黑盒测试</span>
<span class="token comment">// 3.测试重点在UI（DOM）</span>
<span class="token comment">// 4.安全感高</span>
<span class="token comment">// 5.速度慢</span>

<span class="token comment">// 一般是操作多个组件，多个组件有关联，所以集成测试，只关注用户做了什么操作，展示了什么，不关注代码怎么写的，只关注结果是否正确</span>
<span class="token comment">// BDD测试通过了，代表用户用是没什么问题的</span>
<span class="token comment">// 整个组件树挂载，速度会慢一些</span>
</code></pre></div><h3 id="使用-bdd-和集成测试进行-vuex-项目的测试"><a href="#使用-bdd-和集成测试进行-vuex-项目的测试" class="header-anchor">#</a> 使用 BDD 和集成测试进行 Vuex 项目的测试</h3> <p>如何进行 Vuex 相关的测试？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用vuex管理状态</span>
<span class="token comment">// 1. 安装依赖</span>
<span class="token comment">// 2. 编写store.js文件</span>
<span class="token comment">// 3. main.js中引入</span>
<span class="token comment">// 4. 找到Header.vue的代码，inputValue就从store里面去</span>
<span class="token comment">// 5.@input=&quot;e=&gt;changeInputValue(e.target.value)&quot;</span>
<span class="token comment">// 6.回车会执行addTodoItem,清空需要调用this.changInputValue('')</span>
<span class="token comment">// 7.作为一个开发人员，我们代码写完了，我要做一个回归测试，我要看一下之前的流程还能使用嘛，之前已经有集成测试用例的沉淀了，它会报错，读不到state</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i vuex --save
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">&quot;vuex&quot;</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>vuex<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    inputValue<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">changInputValue</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建根实例的时候把store传减去就可以了</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vuex&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">inputValue</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>inputValue<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      changeInputValue<span class="token operator">:</span> <span class="token string">&quot;changeInputValue&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> findTestWrapper <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../../../utils/testUtils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">&quot;../../TodoList&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//1. 引入store</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;../../../../store&quot;</span><span class="token punctuation">;</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
	1. 用户会在header输入框输入内容
	2. 用户会点击回车按钮
	3.列表项应该增加用户输入内容的列表项
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 现在不能用shallowMount了，是多个组件一起测试，用mount做一个深渲染，把组件树都渲染出来</span>

  <span class="token comment">// 2. 把store传进去</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">,</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inputElem <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;header-input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">&quot;Monster&quot;</span><span class="token punctuation">;</span>
  inputElem<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  inputElem<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  inputElem<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;keyup.enter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;list-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 测试用例就通过了，测试用例里面的代码就复用了</span>
<span class="token comment">// 优势：</span>
<span class="token comment">// 先不考虑测试，先写代码，拿到需求，直接开发</span>
<span class="token comment">// 开发完成之后写测试用例，如果是修改代码，测试用例不需要怎么修改</span>
<span class="token comment">// 如果测试用例通过，那基本上可以确定页面可以正常显示，页面上用户的操作也会成功</span>

<span class="token comment">// 单元测试的话，测试用例通过了，但整体流程未必跑得通，因为单元测试跑的只是一个单元，不能保证所有用户运行的代码集成在一起之后可以正常地运行</span>
<span class="token comment">// 问题：代码地覆盖率就不会那么地高了</span>
<span class="token comment">// 现在只是对新增的逻辑做一些测试，后续可以对删除地逻辑也做一些测试，包括对点击input框进行编辑地测试，现在制作了一个测试，整体覆盖率很低</span>
<span class="token comment">// 可以根据测试覆盖率地报告做相应地测试，但是集成测试很难很高，但是测过的东西一定好用</span>
<span class="token comment">// 扩充：</span>
<span class="token comment">// 1.一个项目中既可以使用BDD也可以使用TDD，既可以使用单元测试也可以使用集成测试，混着用，有函数库用TDD+单测，业务逻辑使用BDD+集测</span>
<span class="token comment">// 2.案例2：对store做一个单独的单元测试才去TDD，什么样的测试对我是有价值有必要的时候就可以去做</span>
<span class="token comment">// 掌握前端自动化测试指的是，能够结合项目的需求诉求，去做出正确的判断什么时候去使用TDD或BDD，单元测试或者集成测试，测试业务优先BDD+集成测试，测试函数库优先使用TDD+单元测试</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// store.test.js</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;../../../../store&quot;</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;当store接收changeInputValue的commit时，inputValue发生变化&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;changeInputValue&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="异步测试"><a href="#异步测试" class="header-anchor">#</a> 异步测试</h3> <p>集成测试+BDD,很好的确保代码的质量，同时确保测试用例通过，用户就可以使用，如何通过 BDD+集成测试对异步的代码做一个测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 现在希望做一个新的功能:当页面加载完成的时候去发一个ajax请求，获取服务器返回的数据显示到列表中</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i axios --save
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 5秒之后再发送ajax请求呢</span>

    <span class="token comment">/*
        {
            success:true,
            data:[{
                status:'div',
                value:'Monster'
            }]
        }
        */</span>
    <span class="token comment">// 请求不到会走catch，但是并不耽误我们去写前端的自动化测试用例，即便后端没有提供这样的接口给我们，因为我们不会真正去请求而是模拟这个接口返回的数据.</span>
    <span class="token comment">// 对于前端来说，我们只关注当我们接收到真正的数据的时候，我怎么处理，当我接收到错误的数据我怎么处理，具体这个数据返回地正不正确，前端不是特别关注地，而后端地自动化测试应该关注这个内容地结构体地样子的</span>
    <span class="token comment">// 后端的接口也不一定写完了</span>
    axios
      <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/getUndoList.json&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>undoList <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> findTestWrapper <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../../../utils/testUtils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">&quot;../../TodoList&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//1. 引入store</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;../../../../store&quot;</span><span class="token punctuation">;</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
	1. 用户会在header输入框输入内容
	2. 用户会点击回车按钮
	3.列表项应该增加用户输入内容的列表项
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 现在不能用shallowMount了，是多个组件一起测试，用mount做一个深渲染，把组件树都渲染出来</span>

  <span class="token comment">// 2. 把store传进去</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">,</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inputElem <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;header-input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">&quot;Monster&quot;</span><span class="token punctuation">;</span>
  inputElem<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  inputElem<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  inputElem<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;keyup.enter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;list-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 首先写一个story</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
	1. 用户进入页面时，请求远程数据（等待5s）
	2. 列表应该展示远程返回的数据
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 去渲染一下wrapper，现在去发ajax请求，请求过后应该有对应的几条数据</span>
  <span class="token comment">// 因为挂载的时候就会去请求数据</span>
  <span class="token comment">// 1. 去建一个文件夹__mock__以及axios.js文件</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">,</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 还没等拿到数据，组件就渲染，所以我想等数据拿到之后</span>
  <span class="token comment">// const listItems = findTestWrapper(wrapper,'list-item')</span>
  <span class="token comment">// expect(listItems.length).toBe(2)</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;list-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//------------------------------------</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 数据变了自动更新</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;list-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3，4也可以通过，测试用例里面出现了异步的代码，不会等你代码完成的再关闭测试用例的</span>
    <span class="token comment">// done函数</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//-------------------------------------------</span>
  <span class="token comment">// 5s的请求，使用jest.useFakeTimers()，配合jest.runAllTimers()</span>
  <span class="token comment">// 测试时不通过的。业务代码的setTimeout同步执行，但是里面有有一个异步代码，数据我们还没拿到，所以还需要$nextTick()</span>
  jest<span class="token punctuation">.</span><span class="token function">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;list-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//-------------------------------------------</span>
  <span class="token comment">// 挂载的时候就被调用了1次，可以写个断言，测试不通过，实际调用一次，但是真正调用了2次，原因：上面的测试用例对下面的测试用例产生了影响，两个测试用例存在影响，需要beforeEach(()=&gt;{jest.useFakeTimers()}),测试之前清零</span>
  <span class="token comment">// expect(setTimeout).toHaveBeenCalledTimes(1)</span>
  jest<span class="token punctuation">.</span><span class="token function">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;list-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> undolist <span class="token operator">=</span> <span class="token punctuation">{</span>
  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token string">&quot;Monster&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token string">&quot;Bear&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">&quot;/getUndoList.json&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolved<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>undolist<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> findTestWrapper <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../../../utils/testUtils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">&quot;../../TodoList&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;../../../../store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;../../__mocks__/axios&quot;</span><span class="token punctuation">;</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  axios<span class="token punctuation">.</span>success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  jest<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ----------------------------补充异步代码的测试</span>
<span class="token comment">//</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
	1. 用户进入页面时，请求远程数据
	2. 列表应该展示远程返回的数据
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">,</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;list-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
	1. 用户进入页面时，请求远程数据失败
	2. 列表应该展示空数据，不应该挂掉
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  axios<span class="token punctuation">.</span>success <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">,</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// $nextTick也是一个异步的函数，需要使用done</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">&quot;list-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>listItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> undolist <span class="token operator">=</span> <span class="token punctuation">{</span>
  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token string">&quot;Monster&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token string">&quot;Bear&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">&quot;/getUndoList.json&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolved<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>undolist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="路由页面的代码组织"><a href="#路由页面的代码组织" class="header-anchor">#</a> 路由页面的代码组织</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 复杂的项目进行代码组织</span>
<span class="token comment">// NotFoundPage</span>
<span class="token comment">// 有多个页面</span>
<span class="token comment">// NotFoundPage文件夹下放__mocks__以及__tests__/unit以及__tests__/integration文件夹以及组件vue</span>

<span class="token comment">// 其他页面组织形式</span>
<span class="token comment">// components所有组件打平放到这里面，而不是页面级别下管理组件，页面级别下只有页面，这样页面级别下的tests就可以直接放测试文件，我们会认为这是集成测试文件，然后我们到components文件夹下创建tests和__mock__文件夹做单元测试甚至小组件的集成测试</span>
<span class="token comment">// 这样比较好理解你的页面组织结构，方便了解你的测试代码结构</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i vue-router --save
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> TodoList<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> routes <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 引入到实例中以及router-view</span>
</code></pre></div><h2 id="react-中的-tdd-与单元测试-x"><a href="#react-中的-tdd-与单元测试-x" class="header-anchor">#</a> React 中的 TDD 与单元测试（x）</h2> <p>React 环境中配置 Jest</p> <p>Enzyme 的配置及使用</p> <p>TDD 方式开发 Header 组件</p> <p>Header 组件样式新增及快照测试</p> <p>通用代码提取封装</p> <p>UndoList 的实现</p> <p>UndoList 样式修饰及测试代码优化</p> <p>UndoList 编辑功能实现</p> <p>CodeCoverage 代码覆盖率</p> <h2 id="react-中的-bdd-与集成测试-x"><a href="#react-中的-bdd-与集成测试-x" class="header-anchor">#</a> React 中的 BDD 与集成测试(x)</h2> <p>BDD 的概念以及 TDD 的对比</p> <p>使用 BDD 和集成测试进行 Vuex 项目的测试</p> <p>异步测试</p> <p>路由页面的代码组织</p> <h2 id="前端自动化测试的思考总结"><a href="#前端自动化测试的思考总结" class="header-anchor">#</a> 前端自动化测试的思考总结</h2> <h3 id="前端自动化测试的优势"><a href="#前端自动化测试的优势" class="header-anchor">#</a> 前端自动化测试的优势</h3> <ol><li>更好的代码组织，项目的可维护性增强.</li></ol> <blockquote><p>当我们使用前端自动化测试的方案时，我们会采用 TDD 或者 BDD 的方案进行代码的编写，编写代码的时候我们就会考虑测试该怎么去写，代码怎么写更容易进行测试，我们就会对代码进行更深一步的思考，从而使代码组织得到一个优化，帮助我们项目的可维护性更强</p></blockquote> <ol start="2"><li>更小的 Bug 出现概率，尤其是回归测试的 Bug.</li></ol> <blockquote><p>当我们去做代码的回归测试的时候，我们去改变之前代码的逻辑的时候，没有自动化测试的时候，很容易影响功能，如果有了自动化测试，你之前的代码已经沉淀了一些自动化测试的用例，当我们去修改代码，只要重新跑一边用例，就能确保之前写的功能没有任何问题，如果用例出现的报错，代表你修改的代码影响了之前的功能，那就只要修改就好了，这样更小的出现 BUG</p></blockquote> <ol start="3"><li>修改工程质量差的项目，更加安全</li></ol> <blockquote><p>跟第 2 点很像，我们修改代码很担心影响之前的功能，这些测试用例可以保证代码的整体核心功能没问题，修改代码没问题就可以上线了，有问题就修改</p></blockquote> <ol start="4"><li>项目具备潜在的文档特性</li></ol> <blockquote><p>如果自动化测试用例写得很多，通过用例我就知道现在一步一步，整个工程的主流程是什么，核心业务功功能点是什么，之前需要文档去描述项目要做的事情，现在可以通过测试来描述在做什么，其实每个集成测试就是一个 story，这个 story 就可以告诉我们这块代码它的业务逻辑在干什么</p></blockquote> <ol start="5"><li>扩展前端知识面</li></ol> <blockquote><p>可以深入框架的底层原理学习，因为只有了解才更好的写自动化测试用例，可以提升广度</p></blockquote> <h3 id="前端自动化测试的重要知识点"><a href="#前端自动化测试的重要知识点" class="header-anchor">#</a> 前端自动化测试的重要知识点</h3> <ol><li>BDD，TDD。</li></ol> <blockquote><p>函数库 TDD 不错，写业务 BDD 更有帮助，效率更高</p></blockquote> <ol start="2"><li>集成测试，单元测试</li></ol> <blockquote><p>集成测试优势在于覆盖功能比较广，集成测试通过，一般代码问题不大，而单元测试测试更细，可以提高边界测试覆盖率带来很大的帮助，各有优势，业务使用集成测试，函数库单元测试，测得很细的时候也可以使用单元</p></blockquote> <ol start="3"><li><p>测试与业务的解耦</p></li> <li><p>代码测试覆盖率并不代表一定靠谱</p></li></ol> <blockquote><p>高是好事，业务代码做了大量的单元测试都通过了，但是项目不一定跑得起来，覆盖面广，覆盖率高才靠谱，因为集成测试用例多，覆盖率广</p></blockquote> <ol start="5"><li>功能测试以及 UI 测试</li></ol> <blockquote><p>jest,enzme,vtu 是功能测试，相对 UI 测试是比较弱一点的，做 UI 测试需要 cypress 去抓浏览器，e2e 测试</p></blockquote> <ol start="6"><li>测试越独立，隐藏的问题越多</li></ol> <blockquote><p>前端自己模拟数据，但是数据不是自己写得，可以去爬虫，每隔两三天去爬取线上后端的数据，这样可以保证跟后端的数据匹配得上</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Other/Test/" class="prev router-link-active">
        测试
      </a></span> <span class="next"><a href="/Other/Test/Postman.html">
        Postman
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.51963213.js" defer></script><script src="/assets/js/2.d3d2c42b.js" defer></script><script src="/assets/js/259.f220aad5.js" defer></script>
  </body>
</html>
