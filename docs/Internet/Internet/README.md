---
sidebar: auto
---

# 互联网

思考：数据是如何从一个设备传递到另一个设备的？

- 这一切都是由网络协议来规定的。没有网络协议，就没有今天的互联网

互联网、移动互联网、物联网、音视频、直播都离不开网络协议，最熟悉的网络协议可能是 HTTP，为了满足各种需要，有各式各样的网络协议（HTTPS、SMTP、MQTT、RTMP），例如：文件操作 FTP 协议

## C\C++的跨平台原理

C\C++的跨平台：代码（`.c\.cpp`[c-plus-plus]文件）使用平台相关的编译器生成对应平台的可执行文件。也就是说 C\C++编译之后可以直接生成平台对应的可执行文件。所以 C/C++的跨平台需要编译多次。

> 编译 Mach-O（010101）运行 Mac
>
> 编译 PE（p extable 可执行 01010）格式运行 Windows
>
> 编译 ELF 格式运行 Linux

> 一个代码可以跑多个系统或平台，我们就说它是跨平台的

> 可执行文件就是可以直接跑到操作系统上，操作系统直接识别这个文件，加载这个文件，直接搞进内存，读取里面的机器指令来执行的（PE、Mach-O、ELF 格式就是可执行文件）

## Java 的跨平台原理

`*.java`编译`*.class`（字节码文件）

字节码文件（还不是由 01 组成的机器码）对操作系统来说，不是可执行文件。而 JAVA 需要在操作系统下载并启动 JVM（Java 虚拟机），JVM 就可以加载字节码文件，然后就会解析字节码内容，然后就会翻译为机器指令。

Java 的跨平台：一次编译，到处运行（利用的 JVM）

首先编译生成跟平台无关的字节码文件（class 文件），然后由对应平台的 JVM 解析字节码为机器指令。如果代码有语法错误，将编译失败，并不会生成字节码文件，那就不会去运行一个 JVM 程序，最后导致 Java 程序运行失败。

Java 也是一种解释型语言

## 什么是协议

（例如租房协议，协议是用来约束双方的，节省沟通成本）

如果租房协议有一个国家（或国际）标准，会是怎样？

如果有标准意味着都一样，减少沟通成本，都不需要阅读协议了

##　网络协议

用来规定客服端和服务器能干什么，客户端能发什么，服务器能返回什么，有很多客户端和服务器，如果每个公司都有自己的网络协议，那都要按照公司的网络协议去请求，不利于互联网发展，国际标准化组织 ISO，制定标准，HTTP

## 网络互连模型

为了更好地促进互联网络的研究和发展，国际标准化组织 ISO 在 1985 年指定了网络互连模型。（在 1985 年之前就有互联网了，在那之前十分混乱）

OSI 参考模型（Open System interconnect Reference Model）,具有 7 层结构

指定标准的组织不一定有实战经验，他们有理论。

（应用层、表示层、会话层、运输层、网络层、数据链路层、物理层）

> 参考模型

应用层、传输层、网络层、网络接口层

> TCP/IP 协议具备实战意义的

应用层、运输层、网络层、数据链路层、物理层

> 学习研究

请求过程

所有网络协议都会这样一层一层的输出

不管是 HTTP，FTP 还是各种各样的其他网络协议都遵守这个过程

### 请求过程

封装和拆包，少了一层就没了可靠传输。分层的好处（软件架构）

网络层：加入 IP 地址，源 IP，目标 IP

数据链路层：加入 MAC 地址，源 MAC 地址，目标 MAC 地址

### 网络分层（详解）

5-应用层-（FTP、HTTP、SMTP、DNS、DHCP）-报文、用户数据

4-运输层-（TCP、UDP）-段（Segments）

3-网路层-（IP、ARP、ICMP）-包（Packets）

2-数据链路层-（CSMA/CD、PPP）-帧（Frames）

1-物理层-（）-比特流（Bits）

### 物理层（Physical）

物理层定义了接口标准、线缆标准、传输速率、传输方式等

#### 数字信号、模拟信号

模拟信号（Analog Signal）

- 连续的信号，适合长距离传输
- 抗干扰能力差，收到干扰时波形变形很难纠正

数字信号（Digital Signal）

- 离散的信号，不适合长距离传输
- 抗干扰能力强，收到干扰时波形失真可以修复

#### 数据通信模型

- 局域网光通信模型

PC=>(数字信号/网线)=>集线器\交换机=>(数字信号\网线)=>PC

注意：网线不能超过 100 米

- 广域网通信模型

PC=>(数字信号/网线)=>调制解调器=>(模拟信号\电话线)=>调制解调器=>(数字信号/网线)=>PC

PC=>(数字信号/网线)=>光电转换器=>(光信号\光纤)=>光电转换器=>(数字信号/网线)=>PC

#### 信道（Channel）

信道：信息传输的哦那个到，一条传输介质上（比如网线）上可以有多条信道

单工通信：信号只能往一个方向传输，任何时候都不能改变信号的传输方向（比如无线电广播、有线电视广播）

半双工通信：信号可以双向传输，但必须是交替进行，同一时间只能往一个方向传输（比如对讲机）

全双工通信：信号可以同时双向传输（比如手机，打电话，听说同时进行）

更深了解信道复用。。。。

### 数据链路层（Data Link）

链路：从一个节点到相连节点的一段物理线路（有线或无线），中间没有其他交换节点（比如交换机）

数据链路：在一条链路上传输数据时，需要有对应的通信协议来控制数据的传输

- 不同类型的数据链路，所用的通信协议可能是不同的
- 广播信道：CSMA/CD 协议（比如同轴电缆、集线器等组成的网络）
- 点对点信道：PPP 协议（比如两个路由器之间的信道）

数据链路层的 3 个基本问题

- 封装成帧
- 透明传输
- 差错检验

#### 封装成帧

帧的数据部分：就是网络层传递下来的数据包（IP 数据包，Packet）

最大传输单元 MTU（Maximum Transfer Unit）:每一种数据链路层协议都规定了所能传送的帧的数据长度上限，以太网的 MTU 为 1500 字节

#### 透明传输

数据部分一旦出现了 SOH（帧开始符）、EOT（帧结束符），就需要转义，加上 ESC 字节填充，反过来，接收端会去掉转义字符

#### 差错检验

帧结束符+FCS=>帧的数据部分=>数据链路层首部+帧开始符

FCS 是根据数据部分+首部计算得出的，FCS 错了就不一样，会丢掉

#### CSMA/CD 协议

CSMA/CD（Carrier Sense Multiple Access with Collsion Detectio）:载波侦听多路访问/冲突检测

使用了 CSMA/CD 的网络可以称为是以太网（Ethernet）,它传输的是以太网帧

以太网帧的格式有：**Ethernet V2 标准**（使用最多）、**IEEE 的 802.3 标准**

为了能够检测正在发送的帧是否产生了冲突，以太网的帧至少需要 64 字节

用交换机组建的网络，已经支持全双工通信，不需要再使用 CSMA/CD,但它传输的帧依然是以太网帧，所以用交换机组建的网络依然可以叫做以太网。

## 网络的一些基本概念

##　计算机之间的通信基础
通信：你发些东西给我，我发些东西给你

首先需要知道对方的 IP 地址，有了 IP 地址还不够，还需要知道 MAC 地址（网卡地址），那是因为自动解析了 MAC 地址。

1. 需要知道对方的 IP 地址
2. 最终是根据 MAC 地址，输送数据到网卡，被网卡接收
   - 如果网卡发现数据的目标 MAC 地址是自己，就会将数据传递给上一层进行处理
   - 如果网卡发现数据的目标 MAC 地址不是自己，就会将数据丢弃，不会传递给上一层进行处理

## 计算机之间的连接方式

###　网线直连

两台设备想通信，最简单的方式就是通过网线（橙白橙，水晶头）。

我们可以使用**Packer Tracer**模拟工具。

> 使用模拟工具简单的模拟两台计算机通信的时候，不在同一个网段是 ping 不通的，需要路由器，因为路由器可以连接两个不同的网段

仿真 PDU 发包等价于 ping,用的 ICMP 协议

ARP 协议广播，广播是在同一个网段中传播的，发广播的目的就是获取对方的 MAC 地址。只有通过 ARP 协议拿到 MAC 地址才能进行 ICMP 协议，

> arp -a 是可以看到计算机的 MAC 地址的缓存的

> MAC 地址是 FFF.FFF.FFF.FFF,全 1，代表是广播，在同一个网段的所有网卡都会接收到广播。

### 同轴电缆(Coaxial)

网线直连无法连接多台设备，不能实现互联。

早期的实现互联是用同轴电缆，同轴电缆左右两边有两个终结电阻，通过 T 型连接器（T 型头）连接计算机从而进行互联。

- 半双工通信（同一时间只能允许一个方向进行发数据）
- 容易冲突
- 不安全
- 中间断了，整个都会瘫了

同轴电缆就是半双工通信，同轴电缆一发送就会到处发送，然后计算机发现 MAC 地址不是自己的，就会直接丢掉，左右两边的电阻就是终止信号。

### 集线器(Hub)

我们发现同轴电缆有一个问题就是说，一个地方除了问题，就会整个都瘫了。所以出现了集线器（相当于同轴电缆升级版）。集线器能保证互传，但是集线器也不会缓存 MAC 地址。而且集线器连接的设备越多，效率越低。

- 半双工通信
- 容易冲突
- 不安全

> 相同设备用的是交叉线，不同设备用的是直通线

> 在终端 arp -a 可以看到当前这台设备缓存的 MAC 地址

### 网桥(Bridge)

网桥只有两个接口，还是连接同一网段（左右两边都是一个冲突域），它记录着一张接口 MAC 地址表

它的好处有：

- 能够通过自学习得知每个接口那侧的 MAC 地址
- 从而起到隔绝冲突鱼的作用（同个冲突域内部就可以同时通信了）

### 交换机(Switch)

网桥只有两个接口，交换机相当于拥有集线器+网桥功能，直接连接计算机，学习完之后就可以很精准的转发了，它是局域网的终极方案。

- 相当于接口更多的网桥（带有集线器转发要求的功能）
- 全双工通信
- 比集线器安全

> 二层交换机没有 IP 地址，三层交换机有 IP 地址

但是如果全球所有的设备都用交换机连接会是什么情况呢？

发广播的时候，全球计算机都会收到，只是要不要把包丢掉的问题，因为都是同一网段，所以可以广播，刚开始不知道 MAC 地址，因此还需要广播

### 路由器(Router)

路由器的作用就是可以在不同的网段之间发送数据，隔绝广播域

网线直连、同轴电缆、集线器、网桥、交换机

- 连接的设备必须在同一网段
- 连接的设备处在同一广播域

路由器

- 可以在不同网段之间转发数据
- 隔绝广播域

主机发数据之前，首先会判断目标主机的 IP 地址跟它是否在同一个网段：

- 在同一个网段，ARP，再通过交换机、集线器等
- 不在同一个网段：通过路由器转发数据

网关(gateway)

跨网段发数据需要通过网关

跨网段通信首先需要去发一个 ARP 广播拿到网关的 MAC 地址，然后在通过网关发一个 ARP 广播得到目标 IP 的 MAC 地址，知道 MAC 地址之后就可以通信了。

#### 总结

- 在不同网段之间转发数据，需要有路由器的支持
- 默认情况下，路由器只知道跟它直连的网段，非直连的网段需要通过静态路由、动态路由告诉它

##### 静态路由

- 管理员手动添加路由信息
- 适用于小规模网络

##### 动态路由

- 路由器通过路由选择协议（比如 RIP、OSPF）自动获取路由信息
- 适用于大规模网络

特定主机路由
网段路由
汇总路由
默认路由

### MAC 地址

- 每一个网卡都有一个 6 字节（48bit）的 MAC 地址（Media Access Control Address）
- 全球唯一，固化在了网卡的 ROM 中，由 IEEE802 标准规定
- 前三个字节:[OUI](http://standards-oui.ieee.org/oui.txt)(Organizationally Unique Identifier),组织唯一标识符

由 IEEE 的注册管理机构分配给厂商

- 后 3 字节:网络接口标识符

由厂商自行分配

组织唯一标识符

44-55-82

网络接口标识符

0A-8C-6D

> ipconfig /all Physical Address 就是网卡地址,全为 1 代表广播地址 FF-FF-FF-FF-FF-FF

#### MAC 地址操作:

1. 查看 MAC 地址 ipconfig/all
2. 修改 MAC 地址

有时候可以通过修改 MAC 地址蹭网

#### MAC 地址的获取

- 当不知道对方主机的 MAC 地址时,可以通过发送 ARP 广播获取对方的 MAC 地址
  - 获取成功后,会缓存 IP 地址、MAC 地址的映射信息,俗称:ARP 缓存
  - 通过 ARP 广播获取的 MAC 地址,属于动态缓存
    - 缓存时间比较短(默认是 2 分钟),过期了就自动删除了

#### 相关命令

- arp -a [主机地址]:查看 ARP 缓存
- arp -d [主机地址]:删除 ARP 缓存
- arp -s 主机地址 MAC 地址:增加一条缓存信息(这里是静态缓存,缓存时间较久,不同系统的存储时间不同)

### IP 地址

IP 地址(Internet Protocol Address):互联网上的每一个主机都有一个 IP 地址

最初是 IPV4,32bit(4 字节),2019 年 11 月 25 日,全球的 IP 地址已经用完

后面推出了 IPV6,128bit(16 字节).

#### IP 地址的组成

- IP 地址由 2 部分组成:网络标识(网络 ID)、主机标识(主机 ID)
  - 同一网段的计算机,网络 ID 相同
  - 通过子网掩码(subnet mask)可以计算出网络 ID(网段):子网掩码&IP 地址(按位与)

> 网段能有多少 IP 地址可以用？要减去全 0 和全 1，主机位全零的代表网段，所以不可能全０，全１代表广播

- 计算机和其他计算机通信前，会先判断目标主机和自己是否在同一网段
  - 同一网段：不需要由路由器进行转发
  - 不同网段：交由路由器进行转发

#### IP 地址的分类

A 类地址:默认子网掩码是 255.0.0.0

8bit 作为网络 ID0 开头,24bit 作为主机 ID

网络 ID

- 0 不能用,127 作为保留网段,其中 127.0.0.1 是本地环回地址(Loopback),代表本机地址
- 可以分配给主机的
  - 第一部分的取值范围是 1~126

主机 ID

- 第 2、3、4 部分的取值范围是 0~255
- 每个 A 类网络能容纳的最大主机数是:256\*256\*256-2=2 的 24 次方-2=16777214

B 类地址:默认子网掩码是 255.255.0.0

16bit 作为网络 ID10 开头,16bit 作为主机 ID

网络 ID

- 可以分配给主机的
  - 第一部分的取值范围是 128~191
  - 第二部分是:0~255
- 主机 ID
  - 第 3、4 部分的取值范围是 0~255
  - 每个 B 类网络能容纳的最大主机数是:256\*256-2=2 的 16 次方-2=65534

C 类地址:默认子网掩码是 255.255.255.0

24bit 作为网络 ID110 开头,8bit 作为主机 ID

网络 ID

- 可以分配给主机的
  - 第一部分的取值范围是 192~223
  - 第二、三部分是:0~255
- 主机 ID
  - 第 4 部分的取值范围是 0~255
  - 每个 C 类网络能容纳的最大主机数是:256-2=254

D 类地址:以 1110 开头,没有子网掩码,用于多播(组播)地址

第一部分取值范围是:224~239

E 类地址:以 1111 开头,保留为今后使用

第一部分取值范围是:240~255

只有 A\B\C 类地址才能分配给主机

- 主机标识为全 0,表示主机所在的网段
- 主机标识为全 1,表示主机所在网段的全部主机(广播)

> ping 192.168.1.255 代表给 192.168.1 这个网段的所有主机发广播

### 子网掩码的 CIDR 表示方法

CIDR(Classless Inter-Domain Routing):无类别域间路由

子网掩码的 CIDR 表示方法

- 192.168.1.100/24,代表子网掩码有 24 个 1,也就是 255.255.255.0
- 123.210.100.200/16,代表子网掩码有 16 个 1,也就是 255.255.0.0

[计算工具](https://www.sojson.com/convert/subnetmask.html)

### 为什么要进行子网划分?

- 如果需要让 200 台主机在同一个网段内,可以分配一个 C 类网段,比如 192.168.1.0/24
- 共有 254 个可用的 IP 地址:192.168.1.1~192.168.1.254
- 多出 54 个空闲的 IP 地址,这种情况并不算浪费资源

* 如果需要让 500 台主机在同一个网段内,那就分配一个 B 类网段,比如 192.100.0.0/16
* 共有 65534 个可用 IP 地址:192.100.1.0~192.100.255.254
* 多出 65034 台空闲的 IP 地址,这种情况属于极大的浪费资源

如何尽量避免浪费 IP 地址资源?

### 子网划分

- 子网划分:借用主机位作子网位,划分出多个子网

可用分为:

- 等长子网划分:将一个网段等分成多个子网,每个子网的可用 IP 地址数量是一样的
- 变长子网划分:每个子网的可用 IP 地址数量可以是不一样的

[子网划分器](http://www.ab126.com/web/3552.html)

- 子网划分的步骤
  - 确定子网的子网掩码长度
  - 确定子网中第 1 个、最后 1 个主机可用的 IP 地址

#### 等长子网划分-等分成 2 个子网

规律:如果一个子网是原来网络的 1/2,子网掩码往后移 1 位.

C 类网段:192.168.0.0/24=>192.168.0.0/25~192.168.0.128/25[子网掩码:255.255.255.128]

#### 等长子网划分-等分成 4 个子网

规律:如果一个子网是原来网络 1/2\*1/2=1/4,子网掩码往后移 2 位

### 超网

### 一些概念了解

#### 数据包的传输过程（简述）

源 IP 和目标 IP 不变，只是链路层的源 MAC 和目标 MAC 变化了

#### 网络、互联网、因特网

全世界最大的互联网是：因特网（Internet）

- 将全世界所有的计算机都连接在一起
- 一般使用大写 I 开头的 Internet 特指因特网
- 日常生活中说的：你的电脑上不了网。其实就指：你的电脑没有连接到因特网。

#### ISP

ISP（Internet Service Provider）,Internet 服务提供商，比如移动、电信、网通、铁通等

我们平时拉的宽带都是通过 ISP 连接到 Internet 的

#### 服务器机房

电信机房-移动机房-双线机房

#### 网络分类

按照网络的范围进行分类，可以分为局域网、城域网、广域网等

- 局域网（Local Area Network,LAN）

  - 一般是范围在几百米到十几公里内的计算机所构成的计算机网络
  - 常用于公司、家庭、学校、医院、机关、一栋大楼等
  - 局域网中使用最广泛的网络技术叫：以太网（Ethernet）
  - 在电脑、手机上经常见到的一个英文 WLAN（wireless LAN）,意思是无线局域网

- 城域网（Metropolitan Area Network,MAN）

  - 一般范围是数十公里到数百公里，可以覆盖一个城市

- 广域网（Wide Area Netword,WAN）
  - 一般范围是几百公里到几千公里，可以覆盖一个国家。通常都需要租用 ISP 的线路

#### 常见的几种接口

- FastEthernet(快速以太网接口 100M)
- GigabitEthernet(千兆以太网接口)
- Serial(串行接口)

#### 上网方式

**电话线入户**

这就是平时说的：ADSL 电话拨号上网（Asymmetric Digital Subscriber Line），非对称数字用户线路，提供上、下行不对称的传输带宽

猫（Modem）,调制解调器，进行数字信号和模拟信号的转换

**光纤入户**

光猫（Optical Modem）,光调制解调器，进行数字信号和光信号的转换

**网线入户**

####　公网 IP、私网 IP
IP 地址分为：公网 IP、私网 IP

- 公网 IP（Public）

  - Internet 上的路由器中只有到达公网的路由表，没有到达私网的路由表
  - 公网 IP 是由因特网信息中心统一分配和管理
  - ISP 需要向 Inter NIC 申请公网 IP

- 私网 IP（Private）
  - 主要用于局域网。下面是保留的私网网段
  - A 类:10.0.0.0/8,1 个 A 类网络
  - B 类：172.16.0.0/16~172.31.0.0/16，1 个 B 类网络
  - C 类：192.168.0.0/24~192.168.255.0/24，256 个 C 类网络

#### NAT

私网 IP 访问 Internet 需要进行 NAT 转换为公网 IP

- NAT（Network Address Translation）
- 这一步可以由路由器来完成

NAT 的特点

- 可以节约公网 IP 资源
- 会隐藏内部真实 IP

NAT 分类

- 静态转换

  - 手动配置 NAT 映射表
  - 一对一转换

- 动态转换

  - 定义外部地址池，动态随机转换
  - 一对一转换

- PAT（Port Address Translation）
  - 多对一转换，最大程度节约公网 IP 资源
  - 采用端口多路复用方式，通过端口号表示不同的数据流（客户端端口）
  - 目前应用最广泛的 NAT 实现方式

#### 第一个包的丢失

ping 会发四次包，路由器忙不过来，就把包丢了
