# 闭包

- 闭包

  1.如何产生闭包?

  当一个嵌套的内部（子）函数引用了嵌套的外部（父）函数的变量（函数）时，就产生了闭包

  2.闭包到底是什么？

  - 使用 chrome 调试查看
  - 理解一：闭包是嵌套的内部函数（绝大部分人）
  - 理解二：包含被引用变量（函数）的对象（极少数人）
  - 注意：闭包存在嵌套的内部函数中

    3.产生闭包的条件？

  - 函数嵌套
  - 内部函数引用了外部函数的数据（变量/函数）

- 理解闭包

  作用域：全局作用域和函数作用域

  闭包就是 fn2，既能够读取其他函数内部变量的函数，定义在一个函数内部的函数

  闭包最大的特点：就是他可以记住诞生的环境，比如 fn2 记住了它诞生的环境是 fn1，所以在 fn2 中可以得到 fn1 中的内部变量

  本质上：闭包就是函数内部和函数外部链接的一座桥梁

1. 闭包的用途

一：计数器

作用：读取函数内部的变量，这些变量始终在内存中，使用闭包小心内存泄漏

二：闭包能够封装对象的私有属性和方法

3. 闭包的注意点

一：使用闭包使得函数中的变量始终在内存中，内存消耗很大，所以不能滥用闭包，否则会造成页面性能问题，在 IE 中可能导致内存泄漏 delete null

每个父函数调用完成，都会形成新的闭包，父函数中的变量始终会在内存中，相当于缓存，小心内存的消耗问题

总结：闭包需要三个条件

1. 函数嵌套
2. 访问所在的作用域
3. 在所在作用域外调用

## 其它

**闭包是指有权访问另一个函数作用域内变量的函数**，创建闭包的最常见的方式就是在一个函数内创建另一个函数，创建的函数可以 访问到当前函数的局部变量。

闭包有两个常用的用途。

- 闭包的第一个用途是使我们在函数外部能够访问到函数内部的变量。通过使用闭包，我们可以通过在外部调用闭包函数，从而在外部访问到函数内部的变量，可以使用这种方法来创建私有变量。
- 函数的另一个用途是使已经运行结束的函数上下文中的变量对象继续留在内存中，因为闭包函数保留了这个变量对象的引用，所以这个变量对象不会被回收。

```
function a(){
    var n = 0;
    function add(){
       n++;
       console.log(n);
    }
    return add;
}
var a1 = a(); //注意，函数名只是一个标识（指向函数的指针），而（）才是执行函数；
a1();    //1
a1();    //2  第二次调用n变量还在内存中
```

其实闭包的本质就是作用域链的一个特殊的应用，只要了解了作用域链的创建过程，就能够理解闭包的实现原理。
