# 缓存

## 缓存的使用场景

当用户使用我们的网站/APP 时，他们操作的数据基本来源于我们底层的数据库，那么当用户量比较大的时候，数据库的读写压力也会随之增加，一般情况下，我们会缓存一下热点数据，缓存数据的目的是，一方面可以让网站/APP 可以直接从缓存拿数据，有更快的响应；另一方面，可以减轻数据库的负担，Redis 就是常用的缓存数据库

## 缓存存在的问题

其实只有一个，不可用问题。当缓存不可用时，用户的请求最后会落在 DB 上，在高并发或者有人恶意攻击的情况下，有可能导致 DB 崩溃。缓存中可能会出现问题的情况。

### 缓存穿透

当用户访问了一个本身就不存在的缓存，那么用户的请求最终会落在 DB 上，那么在高并发或者有人恶意攻击的情况下，就会产生之前所说的问题。

解决方法：

1. 使用布隆过滤器判断缓存中是否存在。
2. 为请求设置一个值为 null 的缓存，设置较短的过期时间。

### 缓存击穿

当用户访问缓存数据库，发现缓存已经过期失效，那么就要去 DB 重新拿缓存并且写入缓存数据库，如果在这时有高并发的请求，就会导致瞬间 DB 压力过大。

解决方法：

1. 热点数据的缓存永不过期，可以解决瞬间数据库压力过大的问题。
2. 采用分布式锁，缓存失效后只有一个线程更新并写入缓存数据库。

### 缓存雪崩

大面积的缓存击穿或服务不可用就成为缓存雪崩。

解决方式：

1. 使用 Redis 哨兵或集群等架构提升可用性。
2. 采用和缓存击穿一样的方式。
3. 错开缓存数据的过期时间点，防止缓存大面积失效。
